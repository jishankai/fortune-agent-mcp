import { createRequire } from 'module';
import { logger } from './logger.js';

/**
 * 地理位置查询服务
 * 实现中文地址到经纬度坐标的转换
 */

/**
 * 中国主要城市和地区坐标数据库
 */
const CHINA_REGIONS = {
  // 直辖市
  "北京市": {
    "北京市": { lat: 39.9042, lng: 116.4074, level: "市", aliases: ["京", "北京", "燕京"] },
    "东城区": { lat: 39.9289, lng: 116.4203, level: "区" },
    "西城区": { lat: 39.9139, lng: 116.3657, level: "区" },
    "朝阳区": { lat: 39.9209, lng: 116.4863, level: "区" },
    "丰台区": { lat: 39.8579, lng: 116.2868, level: "区" },
    "石景山区": { lat: 39.9056, lng: 116.1958, level: "区" },
    "海淀区": { lat: 39.9586, lng: 116.2980, level: "区" },
    "门头沟区": { lat: 39.9377, lng: 116.1068, level: "区" },
    "房山区": { lat: 39.7489, lng: 115.9884, level: "区" },
    "通州区": { lat: 39.9026, lng: 116.6574, level: "区" },
    "顺义区": { lat: 40.1282, lng: 116.6555, level: "区" },
    "昌平区": { lat: 40.2206, lng: 116.2352, level: "区" },
    "大兴区": { lat: 39.7287, lng: 116.3384, level: "区" },
    "怀柔区": { lat: 40.3242, lng: 116.6374, level: "区" },
    "平谷区": { lat: 40.1445, lng: 117.1114, level: "区" },
    "密云区": { lat: 40.3769, lng: 116.8432, level: "区" },
    "延庆区": { lat: 40.4652, lng: 115.9742, level: "区" }
  },
  
  "上海市": {
    "上海市": { lat: 31.2304, lng: 121.4737, level: "市", aliases: ["沪", "上海", "申"] },
    "黄浦区": { lat: 31.2246, lng: 121.4903, level: "区" },
    "徐汇区": { lat: 31.1886, lng: 121.4367, level: "区" },
    "长宁区": { lat: 31.2204, lng: 121.4197, level: "区" },
    "静安区": { lat: 31.2457, lng: 121.4489, level: "区" },
    "普陀区": { lat: 31.2497, lng: 121.3954, level: "区" },
    "虹口区": { lat: 31.2646, lng: 121.5050, level: "区" },
    "杨浦区": { lat: 31.2590, lng: 121.5219, level: "区" },
    "闵行区": { lat: 31.1123, lng: 121.3810, level: "区" },
    "宝山区": { lat: 31.4041, lng: 121.4896, level: "区" },
    "嘉定区": { lat: 31.3746, lng: 121.2655, level: "区" },
    "浦东新区": { lat: 31.2220, lng: 121.5367, level: "区" },
    "金山区": { lat: 30.7417, lng: 121.3300, level: "区" },
    "松江区": { lat: 31.0322, lng: 121.2267, level: "区" },
    "青浦区": { lat: 31.1516, lng: 121.1240, level: "区" },
    "奉贤区": { lat: 30.9177, lng: 121.4742, level: "区" },
    "崇明区": { lat: 31.6270, lng: 121.3972, level: "区" }
  },

  "天津市": {
    "天津市": { lat: 39.0842, lng: 117.2008, level: "市", aliases: ["津", "天津"] },
    "和平区": { lat: 39.1189, lng: 117.2006, level: "区" },
    "河东区": { lat: 39.1248, lng: 117.2263, level: "区" },
    "河西区": { lat: 39.1040, lng: 117.2168, level: "区" },
    "南开区": { lat: 39.1204, lng: 117.1647, level: "区" },
    "河北区": { lat: 39.1561, lng: 117.2057, level: "区" },
    "红桥区": { lat: 39.1661, lng: 117.1596, level: "区" }
  },

  "重庆市": {
    "重庆市": { lat: 29.5630, lng: 106.5516, level: "市", aliases: ["渝", "重庆", "山城"] },
    "渝中区": { lat: 29.5569, lng: 106.5697, level: "区" },
    "万州区": { lat: 30.8077, lng: 108.4086, level: "区" },
    "涪陵区": { lat: 29.7032, lng: 107.3943, level: "区" },
    "渝北区": { lat: 29.7181, lng: 106.6311, level: "区" },
    "沙坪坝区": { lat: 29.5412, lng: 106.4567, level: "区" },
    "九龙坡区": { lat: 29.5023, lng: 106.5109, level: "区" },
    "南岸区": { lat: 29.5237, lng: 106.5608, level: "区" },
    "北碚区": { lat: 29.8256, lng: 106.4378, level: "区" },
    "綦江区": { lat: 29.0282, lng: 106.6516, level: "区" },
    "大足区": { lat: 29.7007, lng: 105.7214, level: "区" },
    "黔江区": { lat: 29.5273, lng: 108.7703, level: "区" }
  },

  // 省份和主要城市
  "广东省": {
    "广州市": { lat: 23.1291, lng: 113.2644, level: "市", aliases: ["穗", "广州", "羊城"] },
    "深圳市": { lat: 22.5431, lng: 114.0579, level: "市", aliases: ["深圳", "鹏城"] },
    "珠海市": { lat: 22.2769, lng: 113.5678, level: "市" },
    "汕头市": { lat: 23.3547, lng: 116.6810, level: "市" },
    "佛山市": { lat: 23.0218, lng: 113.1219, level: "市" },
    "韶关市": { lat: 24.8016, lng: 113.5912, level: "市" },
    "湛江市": { lat: 21.2707, lng: 110.3594, level: "市" },
    "肇庆市": { lat: 23.0786, lng: 112.4702, level: "市" },
    "江门市": { lat: 22.5751, lng: 113.0818, level: "市" },
    "茂名市": { lat: 21.6631, lng: 110.9254, level: "市" },
    "惠州市": { lat: 23.1115, lng: 114.4152, level: "市" },
    "梅州市": { lat: 24.2886, lng: 116.1226, level: "市" },
    "汕尾市": { lat: 22.7787, lng: 115.3750, level: "市" },
    "河源市": { lat: 23.7341, lng: 114.6979, level: "市" },
    "阳江市": { lat: 21.8593, lng: 111.9823, level: "市" },
    "清远市": { lat: 23.6817, lng: 113.0538, level: "市" },
    "东莞市": { lat: 23.0209, lng: 113.7518, level: "市" },
    "中山市": { lat: 22.5177, lng: 113.3927, level: "市" },
    "潮州市": { lat: 23.6567, lng: 116.6309, level: "市" },
    "揭阳市": { lat: 23.5479, lng: 116.3729, level: "市" },
    "云浮市": { lat: 22.9155, lng: 112.0442, level: "市" }
  },

  "江苏省": {
    "南京市": { lat: 32.0603, lng: 118.7969, level: "市", aliases: ["宁", "南京", "金陵", "建康"] },
    "无锡市": { lat: 31.4912, lng: 120.3124, level: "市" },
    "徐州市": { lat: 34.2619, lng: 117.2848, level: "市" },
    "常州市": { lat: 31.7725, lng: 119.9462, level: "市" },
    "苏州市": { lat: 31.2989, lng: 120.5853, level: "市", aliases: ["苏州", "姑苏"] },
    "南通市": { lat: 32.0085, lng: 120.8647, level: "市" },
    "连云港市": { lat: 34.5962, lng: 119.1248, level: "市" },
    "淮安市": { lat: 33.5975, lng: 119.0153, level: "市" },
    "盐城市": { lat: 33.3775, lng: 120.1614, level: "市" },
    "扬州市": { lat: 32.3932, lng: 119.4217, level: "市" },
    "镇江市": { lat: 32.2044, lng: 119.4520, level: "市" },
    "泰州市": { lat: 32.4849, lng: 119.9153, level: "市" },
    "宿迁市": { lat: 33.9630, lng: 118.2757, level: "市" }
  },

  "浙江省": {
    "杭州市": { lat: 30.2741, lng: 120.1551, level: "市", aliases: ["杭", "杭州", "临安"] },
    "宁波市": { lat: 29.8683, lng: 121.5440, level: "市" },
    "温州市": { lat: 27.9943, lng: 120.6994, level: "市" },
    "嘉兴市": { lat: 30.7467, lng: 120.7507, level: "市" },
    "湖州市": { lat: 30.8936, lng: 120.0856, level: "市" },
    "绍兴市": { lat: 30.0023, lng: 120.5822, level: "市" },
    "金华市": { lat: 29.1028, lng: 119.6472, level: "市" },
    "衢州市": { lat: 28.9419, lng: 118.8732, level: "市" },
    "舟山市": { lat: 29.9853, lng: 122.2072, level: "市" },
    "台州市": { lat: 28.6568, lng: 121.4200, level: "市" },
    "丽水市": { lat: 28.4517, lng: 119.9219, level: "市" }
  },

  "山东省": {
    "济南市": { lat: 36.6512, lng: 117.1201, level: "市", aliases: ["济", "济南", "泉城"] },
    "青岛市": { lat: 36.0671, lng: 120.3826, level: "市" },
    "淄博市": { lat: 36.8133, lng: 118.0548, level: "市" },
    "枣庄市": { lat: 34.8103, lng: 117.3226, level: "市" },
    "东营市": { lat: 37.4616, lng: 118.6747, level: "市" },
    "烟台市": { lat: 37.4638, lng: 121.4475, level: "市" },
    "潍坊市": { lat: 36.7070, lng: 119.1615, level: "市" },
    "济宁市": { lat: 35.4156, lng: 116.5873, level: "市" },
    "泰安市": { lat: 36.1943, lng: 117.0888, level: "市" },
    "威海市": { lat: 37.5126, lng: 122.1200, level: "市" },
    "日照市": { lat: 35.4164, lng: 119.5269, level: "市" },
    "莱芜市": { lat: 36.2045, lng: 117.6571, level: "市" },
    "临沂市": { lat: 35.1041, lng: 118.3563, level: "市" },
    "德州市": { lat: 37.4608, lng: 116.3574, level: "市" },
    "聊城市": { lat: 36.4567, lng: 115.9857, level: "市" },
    "滨州市": { lat: 37.3835, lng: 117.9708, level: "市" },
    "菏泽市": { lat: 35.2336, lng: 115.4692, level: "市" }
  },

  // 添加缺失的省份
  "河北省": {
    "石家庄市": { lat: 38.0428, lng: 114.5149, level: "市", aliases: ["石家庄"] },
    "唐山市": { lat: 39.6351, lng: 118.1900, level: "市" },
    "秦皇岛市": { lat: 39.9353, lng: 119.6010, level: "市" },
    "邯郸市": { lat: 36.6123, lng: 114.4900, level: "市" },
    "邢台市": { lat: 37.0682, lng: 114.5086, level: "市" },
    "保定市": { lat: 38.8740, lng: 115.4648, level: "市" },
    "张家口市": { lat: 40.8110, lng: 114.8794, level: "市" },
    "承德市": { lat: 40.9542, lng: 117.9396, level: "市" },
    "沧州市": { lat: 38.3170, lng: 116.8579, level: "市" },
    "廊坊市": { lat: 39.5238, lng: 116.7049, level: "市" },
    "衡水市": { lat: 37.7348, lng: 115.6657, level: "市" }
  },

  "山西省": {
    "太原市": { lat: 37.8706, lng: 112.5489, level: "市", aliases: ["太原", "并州"] },
    "大同市": { lat: 40.0760, lng: 113.2950, level: "市" },
    "阳泉市": { lat: 37.8571, lng: 113.5833, level: "市" },
    "长治市": { lat: 36.1914, lng: 113.1132, level: "市" },
    "晋城市": { lat: 35.4977, lng: 112.8513, level: "市" },
    "朔州市": { lat: 39.3311, lng: 112.4332, level: "市" },
    "晋中市": { lat: 37.6872, lng: 112.7537, level: "市" },
    "运城市": { lat: 35.0228, lng: 111.0073, level: "市" },
    "忻州市": { lat: 38.4177, lng: 112.7340, level: "市" },
    "临汾市": { lat: 36.0881, lng: 111.5179, level: "市" },
    "吕梁市": { lat: 37.5177, lng: 111.1341, level: "市" }
  },

  "辽宁省": {
    "沈阳市": { lat: 41.8057, lng: 123.4315, level: "市", aliases: ["沈阳", "奉天"] },
    "大连市": { lat: 38.9140, lng: 121.6147, level: "市" },
    "鞍山市": { lat: 41.1106, lng: 122.9950, level: "市" },
    "抚顺市": { lat: 41.8773, lng: 123.9576, level: "市" },
    "本溪市": { lat: 41.2979, lng: 123.7705, level: "市" },
    "丹东市": { lat: 40.1290, lng: 124.3541, level: "市" },
    "锦州市": { lat: 41.1191, lng: 121.1353, level: "市" },
    "营口市": { lat: 40.6674, lng: 122.2352, level: "市" },
    "阜新市": { lat: 42.0118, lng: 121.6708, level: "市" },
    "辽阳市": { lat: 41.2693, lng: 123.1819, level: "市" },
    "盘锦市": { lat: 41.1245, lng: 122.0703, level: "市" },
    "铁岭市": { lat: 42.2908, lng: 123.8444, level: "市" },
    "朝阳市": { lat: 41.5768, lng: 120.4514, level: "市" },
    "葫芦岛市": { lat: 40.7560, lng: 120.8560, level: "市" }
  },

  "吉林省": {
    "长春市": { lat: 43.8171, lng: 125.3235, level: "市", aliases: ["长春", "春城"] },
    "吉林市": { lat: 43.8436, lng: 126.5528, level: "市" },
    "四平市": { lat: 43.1703, lng: 124.3505, level: "市" },
    "辽源市": { lat: 42.9027, lng: 125.1455, level: "市" },
    "通化市": { lat: 41.7211, lng: 125.9365, level: "市" },
    "白山市": { lat: 41.9425, lng: 126.4276, level: "市" },
    "松原市": { lat: 45.1412, lng: 124.8254, level: "市" },
    "白城市": { lat: 45.6196, lng: 122.8409, level: "市" },
    "延边朝鲜族自治州": { lat: 42.9048, lng: 129.5081, level: "州" }
  },

  "黑龙江省": {
    "哈尔滨市": { lat: 45.8038, lng: 126.5349, level: "市", aliases: ["哈尔滨", "冰城"] },
    "齐齐哈尔市": { lat: 47.3543, lng: 123.9182, level: "市" },
    "鸡西市": { lat: 45.2950, lng: 130.9750, level: "市" },
    "鹤岗市": { lat: 47.3324, lng: 130.2773, level: "市" },
    "双鸭山市": { lat: 46.6434, lng: 131.1572, level: "市" },
    "大庆市": { lat: 46.5901, lng: 125.1031, level: "市" },
    "伊春市": { lat: 47.7248, lng: 128.8992, level: "市" },
    "佳木斯市": { lat: 46.8108, lng: 130.3618, level: "市" },
    "七台河市": { lat: 45.7713, lng: 131.0154, level: "市" },
    "牡丹江市": { lat: 44.5831, lng: 129.6333, level: "市" },
    "黑河市": { lat: 50.2456, lng: 127.4993, level: "市" },
    "绥化市": { lat: 46.6374, lng: 126.9923, level: "市" },
    "大兴安岭地区": { lat: 52.3353, lng: 124.1116, level: "地区" }
  },

  "河南省": {
    "郑州市": { lat: 34.7466, lng: 113.6253, level: "市", aliases: ["郑州", "商都"] },
    "开封市": { lat: 34.7971, lng: 114.3075, level: "市", aliases: ["汴京", "汴梁"] },
    "洛阳市": { lat: 34.6197, lng: 112.4540, level: "市" },
    "平顶山市": { lat: 33.7453, lng: 113.1928, level: "市" },
    "安阳市": { lat: 36.1036, lng: 114.3927, level: "市" },
    "鹤壁市": { lat: 35.7554, lng: 114.2976, level: "市" },
    "新乡市": { lat: 35.3026, lng: 113.9268, level: "市" },
    "焦作市": { lat: 35.2161, lng: 113.2418, level: "市" },
    "濮阳市": { lat: 35.7617, lng: 115.0291, level: "市" },
    "许昌市": { lat: 34.0356, lng: 113.8519, level: "市" },
    "漯河市": { lat: 33.5815, lng: 114.0264, level: "市" },
    "三门峡市": { lat: 34.7773, lng: 111.2008, level: "市" },
    "南阳市": { lat: 32.9909, lng: 112.5288, level: "市" },
    "商丘市": { lat: 34.4138, lng: 115.6565, level: "市" },
    "信阳市": { lat: 32.1479, lng: 114.0756, level: "市" },
    "周口市": { lat: 33.6204, lng: 114.6965, level: "市" },
    "驻马店市": { lat: 32.9804, lng: 114.0492, level: "市" },
    "济源市": { lat: 35.0669, lng: 112.6020, level: "市" }
  },

  "湖北省": {
    "武汉市": { lat: 30.5928, lng: 114.3055, level: "市", aliases: ["武汉", "江城"] },
    "黄石市": { lat: 30.2202, lng: 115.0774, level: "市" },
    "十堰市": { lat: 32.6293, lng: 110.7982, level: "市" },
    "宜昌市": { lat: 30.7026, lng: 111.2908, level: "市" },
    "襄阳市": { lat: 32.0090, lng: 112.1441, level: "市" },
    "鄂州市": { lat: 30.3966, lng: 114.8909, level: "市" },
    "荆门市": { lat: 31.0356, lng: 112.2040, level: "市" },
    "孝感市": { lat: 30.9269, lng: 113.9269, level: "市" },
    "荆州市": { lat: 30.3270, lng: 112.2384, level: "市" },
    "黄冈市": { lat: 30.4477, lng: 114.8722, level: "市" },
    "咸宁市": { lat: 29.8426, lng: 114.3224, level: "市" },
    "随州市": { lat: 31.6902, lng: 113.3741, level: "市" },
    "恩施土家族苗族自治州": { lat: 30.2720, lng: 109.4889, level: "州" },
    "仙桃市": { lat: 30.3648, lng: 113.4539, level: "市" },
    "潜江市": { lat: 30.4210, lng: 112.8969, level: "市" },
    "天门市": { lat: 30.6531, lng: 113.1660, level: "市" },
    "神农架林区": { lat: 31.7442, lng: 110.6718, level: "林区" }
  },

  "湖南省": {
    "长沙市": { lat: 28.2282, lng: 112.9388, level: "市", aliases: ["长沙", "星城"] },
    "株洲市": { lat: 27.8274, lng: 113.1513, level: "市" },
    "湘潭市": { lat: 27.8294, lng: 112.9445, level: "市" },
    "衡阳市": { lat: 26.8934, lng: 112.6070, level: "市" },
    "邵阳市": { lat: 27.2375, lng: 111.4691, level: "市" },
    "岳阳市": { lat: 29.3702, lng: 113.1329, level: "市" },
    "常德市": { lat: 29.0319, lng: 111.6990, level: "市" },
    "张家界市": { lat: 29.1269, lng: 110.4793, level: "市" },
    "益阳市": { lat: 28.5701, lng: 112.3552, level: "市" },
    "郴州市": { lat: 25.7706, lng: 113.0328, level: "市" },
    "永州市": { lat: 26.4207, lng: 111.6088, level: "市" },
    "怀化市": { lat: 27.5501, lng: 109.9778, level: "市" },
    "娄底市": { lat: 27.7281, lng: 111.9939, level: "市" },
    "湘西土家族苗族自治州": { lat: 28.3115, lng: 109.7396, level: "州" }
  },

  "安徽省": {
    "合肥市": { lat: 31.8206, lng: 117.2272, level: "市", aliases: ["合肥", "庐州"] },
    "芜湖市": { lat: 31.3262, lng: 118.3721, level: "市" },
    "蚌埠市": { lat: 32.9164, lng: 117.3897, level: "市" },
    "淮南市": { lat: 32.6466, lng: 116.9929, level: "市" },
    "马鞍山市": { lat: 31.6890, lng: 118.5070, level: "市" },
    "淮北市": { lat: 33.9717, lng: 116.7989, level: "市" },
    "铜陵市": { lat: 30.9297, lng: 117.8167, level: "市" },
    "安庆市": { lat: 30.5255, lng: 117.0530, level: "市" },
    "黄山市": { lat: 29.7144, lng: 118.3378, level: "市" },
    "滁州市": { lat: 32.3173, lng: 118.3162, level: "市" },
    "阜阳市": { lat: 32.8963, lng: 115.8140, level: "市" },
    "宿州市": { lat: 33.6341, lng: 116.9640, level: "市" },
    "六安市": { lat: 31.7347, lng: 116.5073, level: "市" },
    "亳州市": { lat: 33.8440, lng: 115.7825, level: "市" },
    "池州市": { lat: 30.6600, lng: 117.4890, level: "市" },
    "宣城市": { lat: 30.9457, lng: 118.7578, level: "市" }
  },

  "江西省": {
    "南昌市": { lat: 28.6820, lng: 115.8581, level: "市", aliases: ["南昌", "洪城"] },
    "景德镇市": { lat: 29.2686, lng: 117.2142, level: "市" },
    "萍乡市": { lat: 27.6229, lng: 113.8520, level: "市" },
    "九江市": { lat: 29.7053, lng: 115.9850, level: "市" },
    "新余市": { lat: 27.8177, lng: 114.9302, level: "市" },
    "鹰潭市": { lat: 28.2384, lng: 117.0695, level: "市" },
    "赣州市": { lat: 25.8314, lng: 114.9409, level: "市" },
    "吉安市": { lat: 27.1138, lng: 114.9864, level: "市" },
    "宜春市": { lat: 27.8043, lng: 114.3916, level: "市" },
    "抚州市": { lat: 27.9839, lng: 116.3582, level: "市" },
    "上饶市": { lat: 28.4544, lng: 117.9713, level: "市" }
  },

  "福建省": {
    "福州市": { lat: 26.0745, lng: 119.2965, level: "市", aliases: ["福州", "榕城"] },
    "厦门市": { lat: 24.4798, lng: 118.0819, level: "市", aliases: ["厦门", "鹭岛"] },
    "莆田市": { lat: 25.4540, lng: 119.0077, level: "市" },
    "三明市": { lat: 26.2654, lng: 117.6389, level: "市" },
    "泉州市": { lat: 24.8748, lng: 118.6757, level: "市" },
    "漳州市": { lat: 24.5109, lng: 117.6470, level: "市" },
    "南平市": { lat: 26.6450, lng: 118.1778, level: "市" },
    "龙岩市": { lat: 25.0913, lng: 117.0175, level: "市" },
    "宁德市": { lat: 26.6651, lng: 119.5274, level: "市" }
  },

  "四川省": {
    "成都市": { lat: 30.6598, lng: 104.0633, level: "市", aliases: ["成都", "蓉城"] },
    "自贡市": { lat: 29.3528, lng: 104.7786, level: "市" },
    "攀枝花市": { lat: 26.5845, lng: 101.7185, level: "市" },
    "泸州市": { lat: 28.8719, lng: 105.4433, level: "市" },
    "德阳市": { lat: 31.1270, lng: 104.3979, level: "市" },
    "绵阳市": { lat: 31.4677, lng: 104.6794, level: "市" },
    "广元市": { lat: 32.4337, lng: 105.8446, level: "市" },
    "遂宁市": { lat: 30.5134, lng: 105.5713, level: "市" },
    "内江市": { lat: 29.5813, lng: 105.0584, level: "市" },
    "乐山市": { lat: 29.5821, lng: 103.7610, level: "市" },
    "南充市": { lat: 30.7954, lng: 106.0847, level: "市" },
    "眉山市": { lat: 30.0756, lng: 103.8312, level: "市" },
    "宜宾市": { lat: 28.7603, lng: 104.6308, level: "市" },
    "广安市": { lat: 30.4564, lng: 106.6333, level: "市" },
    "达州市": { lat: 31.2090, lng: 107.5023, level: "市" },
    "雅安市": { lat: 29.9877, lng: 103.0133, level: "市" },
    "巴中市": { lat: 31.8691, lng: 106.7533, level: "市" },
    "资阳市": { lat: 30.1284, lng: 104.6417, level: "市" },
    "阿坝藏族羌族自治州": { lat: 31.8997, lng: 102.2214, level: "州" },
    "甘孜藏族自治州": { lat: 30.0504, lng: 101.9638, level: "州" },
    "凉山彝族自治州": { lat: 27.8866, lng: 102.2587, level: "州" }
  },

  "贵州省": {
    "贵阳市": { lat: 26.6470, lng: 106.6302, level: "市", aliases: ["贵阳", "筑城"] },
    "六盘水市": { lat: 26.5918, lng: 104.8306, level: "市" },
    "遵义市": { lat: 27.7060, lng: 106.9069, level: "市" },
    "安顺市": { lat: 26.2532, lng: 105.9477, level: "市" },
    "毕节市": { lat: 27.2849, lng: 105.2913, level: "市" },
    "铜仁市": { lat: 27.7183, lng: 109.1973, level: "市" },
    "黔西南布依族苗族自治州": { lat: 25.0877, lng: 104.9062, level: "州" },
    "黔东南苗族侗族自治州": { lat: 26.5834, lng: 107.9851, level: "州" },
    "黔南布依族苗族自治州": { lat: 26.2578, lng: 107.5172, level: "州" }
  },

  "云南省": {
    "昆明市": { lat: 25.0389, lng: 102.7183, level: "市", aliases: ["昆明", "春城"] },
    "曲靖市": { lat: 25.5016, lng: 103.7976, level: "市" },
    "玉溪市": { lat: 24.3505, lng: 102.5437, level: "市" },
    "保山市": { lat: 25.1118, lng: 99.1670, level: "市" },
    "昭通市": { lat: 27.3380, lng: 103.7179, level: "市" },
    "丽江市": { lat: 26.8721, lng: 100.2277, level: "市" },
    "普洱市": { lat: 22.7773, lng: 100.9720, level: "市" },
    "临沧市": { lat: 23.8878, lng: 100.0769, level: "市" },
    "楚雄彝族自治州": { lat: 25.0415, lng: 101.5463, level: "州" },
    "红河哈尼族彝族自治州": { lat: 23.3677, lng: 103.3843, level: "州" },
    "文山壮族苗族自治州": { lat: 23.4009, lng: 104.2446, level: "州" },
    "西双版纳傣族自治州": { lat: 22.0017, lng: 100.7971, level: "州" },
    "大理白族自治州": { lat: 25.6066, lng: 100.2695, level: "州" },
    "德宏傣族景颇族自治州": { lat: 24.4367, lng: 98.5784, level: "州" },
    "怒江傈僳族自治州": { lat: 25.8506, lng: 98.8667, level: "州" },
    "迪庆藏族自治州": { lat: 27.8269, lng: 99.7065, level: "州" }
  },

  "陕西省": {
    "西安市": { lat: 34.3416, lng: 108.9398, level: "市", aliases: ["西安", "长安"] },
    "铜川市": { lat: 34.8969, lng: 108.9451, level: "市" },
    "宝鸡市": { lat: 34.3640, lng: 107.2372, level: "市" },
    "咸阳市": { lat: 34.3292, lng: 108.7047, level: "市" },
    "渭南市": { lat: 34.4996, lng: 109.5097, level: "市" },
    "延安市": { lat: 36.5853, lng: 109.4897, level: "市" },
    "汉中市": { lat: 33.0777, lng: 107.0283, level: "市" },
    "榆林市": { lat: 38.2902, lng: 109.7341, level: "市" },
    "安康市": { lat: 32.6840, lng: 109.0295, level: "市" },
    "商洛市": { lat: 33.8687, lng: 109.9408, level: "市" }
  },

  "甘肃省": {
    "兰州市": { lat: 36.0611, lng: 103.8343, level: "市", aliases: ["兰州", "金城"] },
    "嘉峪关市": { lat: 39.7865, lng: 98.2898, level: "市" },
    "金昌市": { lat: 38.5142, lng: 102.1880, level: "市" },
    "白银市": { lat: 36.5449, lng: 104.1738, level: "市" },
    "天水市": { lat: 34.5784, lng: 105.7249, level: "市" },
    "武威市": { lat: 37.9284, lng: 102.6381, level: "市" },
    "张掖市": { lat: 38.9255, lng: 100.4487, level: "市" },
    "平凉市": { lat: 35.5428, lng: 106.6656, level: "市" },
    "酒泉市": { lat: 39.7320, lng: 98.4938, level: "市" },
    "庆阳市": { lat: 35.7095, lng: 107.6437, level: "市" },
    "定西市": { lat: 35.5796, lng: 104.6262, level: "市" },
    "陇南市": { lat: 33.3886, lng: 104.9219, level: "市" },
    "临夏回族自治州": { lat: 35.5995, lng: 103.2127, level: "州" },
    "甘南藏族自治州": { lat: 34.9864, lng: 102.9109, level: "州" }
  },

  "青海省": {
    "西宁市": { lat: 36.6171, lng: 101.7782, level: "市", aliases: ["西宁"] },
    "海东市": { lat: 36.5023, lng: 102.1038, level: "市" },
    "海北藏族自治州": { lat: 36.9596, lng: 100.9013, level: "州" },
    "黄南藏族自治州": { lat: 35.5196, lng: 102.0198, level: "州" },
    "海南藏族自治州": { lat: 36.2804, lng: 100.6196, level: "州" },
    "果洛藏族自治州": { lat: 34.4717, lng: 100.2423, level: "州" },
    "玉树藏族自治州": { lat: 33.0062, lng: 97.0086, level: "州" },
    "海西蒙古族藏族自治州": { lat: 37.3737, lng: 97.3708, level: "州" }
  },

  "海南省": {
    "海口市": { lat: 20.0444, lng: 110.1989, level: "市", aliases: ["海口", "椰城"] },
    "三亚市": { lat: 18.2528, lng: 109.5122, level: "市" },
    "三沙市": { lat: 16.8310, lng: 112.3391, level: "市" },
    "儋州市": { lat: 19.5175, lng: 109.5766, level: "市" },
    "五指山市": { lat: 18.7769, lng: 109.5169, level: "市" },
    "琼海市": { lat: 19.2462, lng: 110.4665, level: "市" },
    "文昌市": { lat: 19.6129, lng: 110.7539, level: "市" },
    "万宁市": { lat: 18.7962, lng: 110.3887, level: "市" },
    "东方市": { lat: 19.1022, lng: 108.6537, level: "市" },
    "定安县": { lat: 19.6851, lng: 110.3490, level: "县" },
    "屯昌县": { lat: 19.3629, lng: 110.1020, level: "县" },
    "澄迈县": { lat: 19.7372, lng: 110.0071, level: "县" },
    "临高县": { lat: 19.9084, lng: 109.6875, level: "县" },
    "白沙黎族自治县": { lat: 19.2245, lng: 109.4524, level: "县" },
    "昌江黎族自治县": { lat: 19.2605, lng: 109.0530, level: "县" },
    "乐东黎族自治县": { lat: 18.7470, lng: 109.1752, level: "县" },
    "陵水黎族自治县": { lat: 18.5050, lng: 110.0371, level: "县" },
    "保亭黎族苗族自治县": { lat: 18.6364, lng: 109.7022, level: "县" },
    "琼中黎族苗族自治县": { lat: 19.0354, lng: 109.8397, level: "县" }
  },

  // 新疆、西藏、内蒙古、广西、宁夏自治区
  "新疆维吾尔自治区": {
    "乌鲁木齐市": { lat: 43.8256, lng: 87.6168, level: "市", aliases: ["乌鲁木齐", "乌市"] },
    "克拉玛依市": { lat: 45.5950, lng: 84.8891, level: "市" },
    "吐鲁番市": { lat: 42.9513, lng: 89.1889, level: "市" },
    "哈密市": { lat: 42.8335, lng: 93.5281, level: "市" },
    "昌吉回族自治州": { lat: 44.0070, lng: 87.3049, level: "州" },
    "博尔塔拉蒙古自治州": { lat: 44.9030, lng: 82.0519, level: "州" },
    "巴音郭楞蒙古自治州": { lat: 41.7681, lng: 86.1450, level: "州" },
    "阿克苏地区": { lat: 41.1707, lng: 80.2651, level: "地区" },
    "克孜勒苏柯尔克孜自治州": { lat: 39.7142, lng: 76.1679, level: "州" },
    "喀什地区": { lat: 39.4704, lng: 75.9899, level: "地区" },
    "和田地区": { lat: 37.1107, lng: 79.9253, level: "地区" },
    "伊犁哈萨克自治州": { lat: 43.9230, lng: 81.3281, level: "州" },
    "塔城地区": { lat: 46.7463, lng: 82.9857, level: "地区" },
    "阿勒泰地区": { lat: 47.8439, lng: 88.1396, level: "地区" },
    "石河子市": { lat: 44.3059, lng: 86.0411, level: "市" },
    "阿拉尔市": { lat: 40.5420, lng: 81.2769, level: "市" },
    "图木舒克市": { lat: 39.8673, lng: 79.0745, level: "市" },
    "五家渠市": { lat: 44.1674, lng: 87.5268, level: "市" },
    "北屯市": { lat: 47.3531, lng: 87.8249, level: "市" },
    "铁门关市": { lat: 41.8274, lng: 85.6725, level: "市" },
    "双河市": { lat: 44.8403, lng: 82.3537, level: "市" },
    "可克达拉市": { lat: 43.6832, lng: 80.9930, level: "市" },
    "昆玉市": { lat: 37.2072, lng: 79.2737, level: "市" },
    "胡杨河市": { lat: 44.6977, lng: 84.8275, level: "市" }
  },

  "西藏自治区": {
    "拉萨市": { lat: 29.6625, lng: 91.1146, level: "市", aliases: ["拉萨", "日光城"] },
    "日喀则市": { lat: 29.2630, lng: 88.8851, level: "市" },
    "昌都市": { lat: 31.1405, lng: 97.1785, level: "市" },
    "林芝市": { lat: 29.6544, lng: 94.3624, level: "市" },
    "山南市": { lat: 29.2360, lng: 91.7730, level: "市" },
    "那曲市": { lat: 31.4806, lng: 92.0670, level: "市" },
    "阿里地区": { lat: 32.5032, lng: 80.1055, level: "地区" }
  },

  "内蒙古自治区": {
    "呼和浩特市": { lat: 40.8414, lng: 111.7519, level: "市", aliases: ["呼和浩特", "呼市", "青城"] },
    "包头市": { lat: 40.6562, lng: 109.8403, level: "市" },
    "乌海市": { lat: 39.6739, lng: 106.8254, level: "市" },
    "赤峰市": { lat: 42.2574, lng: 118.8870, level: "市" },
    "通辽市": { lat: 43.6174, lng: 122.2632, level: "市" },
    "鄂尔多斯市": { lat: 39.6086, lng: 109.9899, level: "市" },
    "呼伦贝尔市": { lat: 49.2016, lng: 119.7651, level: "市" },
    "巴彦淖尔市": { lat: 40.7574, lng: 107.4160, level: "市" },
    "乌兰察布市": { lat: 41.0341, lng: 113.1325, level: "市" },
    "兴安盟": { lat: 46.0763, lng: 122.0704, level: "盟" },
    "锡林郭勒盟": { lat: 43.9447, lng: 116.0909, level: "盟" },
    "阿拉善盟": { lat: 38.8518, lng: 105.7286, level: "盟" }
  },

  "广西壮族自治区": {
    "南宁市": { lat: 22.8170, lng: 108.3669, level: "市", aliases: ["南宁", "邕", "绿城"] },
    "柳州市": { lat: 24.3146, lng: 109.4281, level: "市" },
    "桂林市": { lat: 25.2342, lng: 110.1792, level: "市" },
    "梧州市": { lat: 23.4740, lng: 111.2790, level: "市" },
    "北海市": { lat: 21.4813, lng: 109.1238, level: "市" },
    "防城港市": { lat: 21.7014, lng: 108.3545, level: "市" },
    "钦州市": { lat: 21.9804, lng: 108.6544, level: "市" },
    "贵港市": { lat: 23.0936, lng: 109.6027, level: "市" },
    "玉林市": { lat: 22.6314, lng: 110.1811, level: "市" },
    "百色市": { lat: 23.9024, lng: 106.6182, level: "市" },
    "贺州市": { lat: 24.4139, lng: 111.5521, level: "市" },
    "河池市": { lat: 24.6963, lng: 108.0852, level: "市" },
    "来宾市": { lat: 23.7338, lng: 109.2287, level: "市" },
    "崇左市": { lat: 22.4041, lng: 107.3644, level: "市" }
  },

  "宁夏回族自治区": {
    "银川市": { lat: 38.5026, lng: 106.2309, level: "市", aliases: ["银川", "凤凰城"] },
    "石嘴山市": { lat: 39.0133, lng: 106.3768, level: "市" },
    "吴忠市": { lat: 37.9974, lng: 106.1992, level: "市" },
    "固原市": { lat: 36.0046, lng: 106.2854, level: "市" },
    "中卫市": { lat: 37.4149, lng: 105.1896, level: "市" }
  },

  // === 港澳台地区完整数据 ===
  "香港特别行政区": {
    // 香港岛4区
    "中西区": { lat: 22.2855, lng: 114.1577, level: "区", aliases: ["中西区", "Central and Western"] },
    "湾仔区": { lat: 22.2783, lng: 114.1747, level: "区", aliases: ["湾仔", "Wan Chai"] },
    "东区": { lat: 22.2899, lng: 114.2094, level: "区", aliases: ["东区", "Eastern"] },
    "南区": { lat: 22.2460, lng: 114.1625, level: "区", aliases: ["南区", "Southern"] },
    
    // 九龙5区
    "油尖旺区": { lat: 22.3080, lng: 114.1714, level: "区", aliases: ["油尖旺", "Yau Tsim Mong"] },
    "深水埗区": { lat: 22.3298, lng: 114.1627, level: "区", aliases: ["深水埗", "Sham Shui Po"] },
    "九龙城区": { lat: 22.3219, lng: 114.1906, level: "区", aliases: ["九龙城", "Kowloon City"] },
    "黄大仙区": { lat: 22.3411, lng: 114.1987, level: "区", aliases: ["黄大仙", "Wong Tai Sin"] },
    "观塘区": { lat: 22.3112, lng: 114.2264, level: "区", aliases: ["观塘", "Kwun Tong"] },
    
    // 新界9区
    "北区": { lat: 22.4964, lng: 114.1486, level: "区", aliases: ["北区", "North"] },
    "大埔区": { lat: 22.4511, lng: 114.1634, level: "区", aliases: ["大埔", "Tai Po"] },
    "沙田区": { lat: 22.3821, lng: 114.1988, level: "区", aliases: ["沙田", "Sha Tin"] },
    "西贡区": { lat: 22.3818, lng: 114.2681, level: "区", aliases: ["西贡", "Sai Kung"] },
    "荃湾区": { lat: 22.3669, lng: 114.1176, level: "区", aliases: ["荃湾", "Tsuen Wan"] },
    "屯门区": { lat: 22.3910, lng: 113.9773, level: "区", aliases: ["屯门", "Tuen Mun"] },
    "元朗区": { lat: 22.4435, lng: 114.0374, level: "区", aliases: ["元朗", "Yuen Long"] },
    "葵青区": { lat: 22.3586, lng: 114.1289, level: "区", aliases: ["葵青", "Kwai Tsing"] },
    "离岛区": { lat: 22.2588, lng: 113.9444, level: "区", aliases: ["离岛", "Islands"] },
    
    // 香港整体
    "香港": { lat: 22.3193, lng: 114.1694, level: "特区", aliases: ["香港", "Hong Kong", "HK"] }
  },

  "澳门特别行政区": {
    // 澳门半岛5个堂区
    "花地玛堂区": { lat: 22.2087, lng: 113.5439, level: "堂区", aliases: ["北区", "Nossa Senhora de Fátima"] },
    "圣安多尼堂区": { lat: 22.1987, lng: 113.5439, level: "堂区", aliases: ["花王堂区", "Santo António"] },
    "大堂区": { lat: 22.1907, lng: 113.5439, level: "堂区", aliases: ["大堂", "Sé Catedral"] },
    "望德堂区": { lat: 22.1967, lng: 113.5508, level: "堂区", aliases: ["望德", "São Lázaro"] },
    "风顺堂区": { lat: 22.1847, lng: 113.5378, level: "堂区", aliases: ["风顺", "São Lourenço"] },
    
    // 离岛2个堂区
    "嘉模堂区": { lat: 22.1564, lng: 113.5594, level: "堂区", aliases: ["氹仔", "Nossa Senhora do Carmo"] },
    "圣方济各堂区": { lat: 22.1264, lng: 113.5594, level: "堂区", aliases: ["路环", "São Francisco Xavier"] },
    
    // 澳门整体
    "澳门": { lat: 22.1987, lng: 113.5439, level: "特区", aliases: ["澳门", "Macau", "Macao"] }
  },

  "台湾省": {
    // 6个直辖市
    "台北市": { lat: 25.0330, lng: 121.5654, level: "市", aliases: ["台北", "Taipei"] },
    "新北市": { lat: 25.0173, lng: 121.4627, level: "市", aliases: ["新北", "New Taipei"] },
    "桃园市": { lat: 24.9936, lng: 121.3010, level: "市", aliases: ["桃园", "Taoyuan"] },
    "台中市": { lat: 24.1477, lng: 120.6736, level: "市", aliases: ["台中", "Taichung"] },
    "台南市": { lat: 22.9999, lng: 120.2269, level: "市", aliases: ["台南", "Tainan"] },
    "高雄市": { lat: 22.6273, lng: 120.3014, level: "市", aliases: ["高雄", "Kaohsiung"] },
    
    // 3个市
    "基隆市": { lat: 25.1276, lng: 121.7391, level: "市", aliases: ["基隆", "Keelung"] },
    "新竹市": { lat: 24.8066, lng: 120.9686, level: "市", aliases: ["新竹", "Hsinchu"] },
    "嘉义市": { lat: 23.4801, lng: 120.4491, level: "市", aliases: ["嘉义", "Chiayi"] },
    
    // 13个县
    "新竹县": { lat: 24.8387, lng: 121.0177, level: "县", aliases: ["新竹县", "Hsinchu County"] },
    "苗栗县": { lat: 24.5601, lng: 120.8214, level: "县", aliases: ["苗栗", "Miaoli"] },
    "彰化县": { lat: 24.0518, lng: 120.5161, level: "县", aliases: ["彰化", "Changhua"] },
    "南投县": { lat: 23.9609, lng: 120.9718, level: "县", aliases: ["南投", "Nantou"] },
    "云林县": { lat: 23.7092, lng: 120.4313, level: "县", aliases: ["云林", "Yunlin"] },
    "嘉义县": { lat: 23.4520, lng: 120.2551, level: "县", aliases: ["嘉义县", "Chiayi County"] },
    "屏东县": { lat: 22.5519, lng: 120.5487, level: "县", aliases: ["屏东", "Pingtung"] },
    "宜兰县": { lat: 24.7021, lng: 121.7378, level: "县", aliases: ["宜兰", "Yilan"] },
    "花莲县": { lat: 23.9871, lng: 121.6015, level: "县", aliases: ["花莲", "Hualien"] },
    "台东县": { lat: 22.7972, lng: 121.1444, level: "县", aliases: ["台东", "Taitung"] },
    "澎湖县": { lat: 23.5711, lng: 119.5794, level: "县", aliases: ["澎湖", "Penghu"] },
    "金门县": { lat: 24.4365, lng: 118.3174, level: "县", aliases: ["金门", "Kinmen"] },
    "连江县": { lat: 26.1565, lng: 119.9397, level: "县", aliases: ["马祖", "Matsu", "连江"] },
    
    // 台湾整体
    "台湾": { lat: 23.8, lng: 121.0, level: "省", aliases: ["台湾", "Taiwan", "Formosa"] }
  }
};

/**
 * 海外华人聚居地数据库
 */
const OVERSEAS_CHINESE_REGIONS = {
  // === 东南亚华人聚居地 ===
  "新加坡": {
    "新加坡": { lat: 1.3521, lng: 103.8198, level: "国家", aliases: ["新加坡", "Singapore", "狮城", "星洲"] }
  },

  "马来西亚": {
    "吉隆坡": { lat: 3.1390, lng: 101.6869, level: "市", aliases: ["吉隆坡", "Kuala Lumpur", "KL"] },
    "新山": { lat: 1.4927, lng: 103.7414, level: "市", aliases: ["新山", "Johor Bahru"] },
    "槟城": { lat: 5.4164, lng: 100.3327, level: "市", aliases: ["槟城", "Penang", "乔治市", "George Town"] },
    "马六甲": { lat: 2.1896, lng: 102.2501, level: "市", aliases: ["马六甲", "Malacca", "Melaka"] },
    "怡保": { lat: 4.5975, lng: 101.0901, level: "市", aliases: ["怡保", "Ipoh"] },
    "古晋": { lat: 1.5533, lng: 110.3592, level: "市", aliases: ["古晋", "Kuching"] },
    "亚庇": { lat: 5.9804, lng: 116.0735, level: "市", aliases: ["亚庇", "Kota Kinabalu"] },
    "八打灵再也": { lat: 3.1073, lng: 101.6067, level: "市", aliases: ["八打灵再也", "Petaling Jaya", "PJ"] },
    "莎阿南": { lat: 3.0738, lng: 101.5183, level: "市", aliases: ["莎阿南", "Shah Alam"] },
    "梳邦再也": { lat: 3.0733, lng: 101.5185, level: "市", aliases: ["梳邦再也", "Subang Jaya"] }
  },

  "泰国": {
    "曼谷": { lat: 13.7563, lng: 100.5018, level: "市", aliases: ["曼谷", "Bangkok"] },
    "清迈": { lat: 18.7883, lng: 98.9853, level: "市", aliases: ["清迈", "Chiang Mai"] },
    "普吉": { lat: 7.8804, lng: 98.3923, level: "市", aliases: ["普吉", "Phuket"] },
    "芭提雅": { lat: 12.9236, lng: 100.8825, level: "市", aliases: ["芭提雅", "Pattaya"] }
  },

  // === 东南亚新增 ===
  "柬埔寨": {
    "金边": { lat: 11.5564, lng: 104.9282, level: "市", aliases: ["金边", "Phnom Penh"] },
    "暹粒": { lat: 13.3671, lng: 103.8448, level: "市", aliases: ["暹粒", "Siem Reap"] }
  },
  "老挝": {
    "万象": { lat: 17.9757, lng: 102.6331, level: "市", aliases: ["万象", "Vientiane"] },
    "琅勃拉邦": { lat: 19.8860, lng: 102.1350, level: "市", aliases: ["琅勃拉邦", "Luang Prabang"] }
  },
  "文莱": {
    "斯里巴加湾市": { lat: 4.9031, lng: 114.9398, level: "市", aliases: ["斯里巴加湾市", "Bandar Seri Begawan"] }
  },
  "东帝汶": {
    "帝力": { lat: -8.5569, lng: 125.5603, level: "市", aliases: ["帝力", "Dili"] }
  },
  "马尔代夫": {
    "马累": { lat: 4.1755, lng: 73.5093, level: "市", aliases: ["马累", "Male"] }
  },
  "蒙古国": {
    "乌兰巴托": { lat: 47.8864, lng: 106.9057, level: "市", aliases: ["乌兰巴托", "Ulaanbaatar", "Ulan Bator"] }
  },
  "朝鲜": {
    "平壤": { lat: 39.0392, lng: 125.7625, level: "市", aliases: ["平壤", "Pyongyang"] }
  },

  "印度尼西亚": {
    "雅加达": { lat: -6.2088, lng: 106.8456, level: "市", aliases: ["雅加达", "Jakarta"] },
    "泗水": { lat: -7.2575, lng: 112.7521, level: "市", aliases: ["泗水", "Surabaya"] },
    "棉兰": { lat: 3.5952, lng: 98.6722, level: "市", aliases: ["棉兰", "Medan"] },
    "万隆": { lat: -6.9175, lng: 107.6191, level: "市", aliases: ["万隆", "Bandung"] },
    "日惹": { lat: -7.7956, lng: 110.3695, level: "市", aliases: ["日惹", "Yogyakarta"] },
    "登巴萨": { lat: -8.6500, lng: 115.2167, level: "市", aliases: ["登巴萨", "Denpasar", "Bali", "巴厘岛"] },
    "望加锡": { lat: -5.1477, lng: 119.4327, level: "市", aliases: ["望加锡", "Makassar"] }
  },

  "菲律宾": {
    "马尼拉": { lat: 14.5995, lng: 120.9842, level: "市", aliases: ["马尼拉", "Manila"] },
    "宿务": { lat: 10.3157, lng: 123.8854, level: "市", aliases: ["宿务", "Cebu"] },
    "达沃": { lat: 7.1907, lng: 125.4553, level: "市", aliases: ["达沃", "Davao"] },
    "奎松市": { lat: 14.6760, lng: 121.0437, level: "市", aliases: ["奎松市", "Quezon City"] },
    "马卡蒂": { lat: 14.5547, lng: 121.0244, level: "市", aliases: ["马卡蒂", "Makati"] },
    "塔吉格": { lat: 14.5204, lng: 121.0537, level: "市", aliases: ["塔吉格", "Taguig"] }
  },

  "缅甸": {
    "仰光": { lat: 16.8661, lng: 96.1951, level: "市", aliases: ["仰光", "Yangon"] },
    "内比都": { lat: 19.7633, lng: 96.0785, level: "市", aliases: ["内比都", "Naypyidaw", "Nay Pyi Taw"] },
    "曼德勒": { lat: 21.9588, lng: 96.0891, level: "市", aliases: ["曼德勒", "Mandalay"] }
  },

  "越南": {
    "胡志明市": { lat: 10.8231, lng: 106.6297, level: "市", aliases: ["胡志明市", "Ho Chi Minh City", "西贡"] },
    "河内": { lat: 21.0285, lng: 105.8542, level: "市", aliases: ["河内", "Hanoi"] },
    "岘港": { lat: 16.0544, lng: 108.2022, level: "市", aliases: ["岘港", "Da Nang", "Danang"] },
    "海防": { lat: 20.8449, lng: 106.6881, level: "市", aliases: ["海防", "Haiphong", "Hai Phong"] },
    "芽庄": { lat: 12.2388, lng: 109.1967, level: "市", aliases: ["芽庄", "Nha Trang"] },
    "顺化": { lat: 16.4637, lng: 107.5909, level: "市", aliases: ["顺化", "Hue"] }
  },

  // === 欧洲华人聚居地 ===
  "法国": {
    "巴黎": { lat: 48.8566, lng: 2.3522, level: "市", aliases: ["巴黎", "Paris"] },
    "马赛": { lat: 43.2965, lng: 5.3698, level: "市", aliases: ["马赛", "Marseille"] },
    "里昂": { lat: 45.7640, lng: 4.8357, level: "市", aliases: ["里昂", "Lyon"] },
    "尼斯": { lat: 43.7102, lng: 7.2620, level: "市", aliases: ["尼斯", "Nice"] },
    "图卢兹": { lat: 43.6047, lng: 1.4442, level: "市", aliases: ["图卢兹", "Toulouse"] },
    "波尔多": { lat: 44.8378, lng: -0.5792, level: "市", aliases: ["波尔多", "Bordeaux"] },
    "里尔": { lat: 50.6292, lng: 3.0573, level: "市", aliases: ["里尔", "Lille"] },
    "南特": { lat: 47.2184, lng: -1.5536, level: "市", aliases: ["南特", "Nantes"] },
    "斯特拉斯堡": { lat: 48.5734, lng: 7.7521, level: "市", aliases: ["斯特拉斯堡", "Strasbourg"] },
    "蒙彼利埃": { lat: 43.6108, lng: 3.8767, level: "市", aliases: ["蒙彼利埃", "Montpellier"] },
    "格勒诺布尔": { lat: 45.1885, lng: 5.7245, level: "市", aliases: ["格勒诺布尔", "Grenoble"] }
  },

  // === 大洋洲华人聚居地 ===
  "澳大利亚": {
    "悉尼": { lat: -33.8688, lng: 151.2093, level: "市", aliases: ["悉尼", "Sydney"] },
    "墨尔本": { lat: -37.8136, lng: 144.9631, level: "市", aliases: ["墨尔本", "Melbourne"] },
    "布里斯班": { lat: -27.4698, lng: 153.0251, level: "市", aliases: ["布里斯班", "Brisbane"] },
    "珀斯": { lat: -31.9505, lng: 115.8605, level: "市", aliases: ["珀斯", "Perth"] },
    "阿德莱德": { lat: -34.9285, lng: 138.6007, level: "市", aliases: ["阿德莱德", "Adelaide"] },
    "堪培拉": { lat: -35.2809, lng: 149.1300, level: "市", aliases: ["堪培拉", "Canberra"] },
    "黄金海岸": { lat: -28.0167, lng: 153.4000, level: "市", aliases: ["黄金海岸", "Gold Coast"] },
    "纽卡斯尔": { lat: -32.9283, lng: 151.7817, level: "市", aliases: ["纽卡斯尔", "Newcastle"] },
    "霍巴特": { lat: -42.8821, lng: 147.3272, level: "市", aliases: ["霍巴特", "Hobart"] },
    "达尔文": { lat: -12.4634, lng: 130.8456, level: "市", aliases: ["达尔文", "Darwin"] }
  },

  "新西兰": {
    "奥克兰": { lat: -36.8485, lng: 174.7633, level: "市", aliases: ["奥克兰", "Auckland"] },
    "惠灵顿": { lat: -41.2865, lng: 174.7762, level: "市", aliases: ["惠灵顿", "Wellington"] },
    "基督城": { lat: -43.5321, lng: 172.6362, level: "市", aliases: ["基督城", "Christchurch"] },
    "汉密尔顿": { lat: -37.7870, lng: 175.2793, level: "市", aliases: ["汉密尔顿", "Hamilton"] },
    "达尼丁": { lat: -45.8788, lng: 170.5028, level: "市", aliases: ["达尼丁", "Dunedin"] },
    "陶朗加": { lat: -37.6878, lng: 176.1651, level: "市", aliases: ["陶朗加", "Tauranga"] },
    "皇后镇": { lat: -45.0312, lng: 168.6626, level: "市", aliases: ["皇后镇", "Queenstown"] }
  },

  // === 其他地区华人聚居地 ===
  "日本": {
    "东京": { lat: 35.6762, lng: 139.6503, level: "市", aliases: ["东京", "Tokyo"] },
    "大阪": { lat: 34.6937, lng: 135.5023, level: "市", aliases: ["大阪", "Osaka"] },
    "横滨": { lat: 35.4437, lng: 139.6380, level: "市", aliases: ["横滨", "Yokohama"] },
    "名古屋": { lat: 35.1815, lng: 136.9066, level: "市", aliases: ["名古屋", "Nagoya"] },
    "京都": { lat: 35.0116, lng: 135.7681, level: "市", aliases: ["京都", "Kyoto"] },
    "札幌": { lat: 43.0618, lng: 141.3545, level: "市", aliases: ["札幌", "Sapporo"] },
    "福冈": { lat: 33.5904, lng: 130.4017, level: "市", aliases: ["福冈", "Fukuoka"] },
    "广岛": { lat: 34.3853, lng: 132.4553, level: "市", aliases: ["广岛", "Hiroshima"] },
    "仙台": { lat: 38.2682, lng: 140.8694, level: "市", aliases: ["仙台", "Sendai"] },
    "神户": { lat: 34.6901, lng: 135.1955, level: "市", aliases: ["神户", "Kobe"] }
  },

  "韩国": {
    "首尔": { lat: 37.5665, lng: 126.9780, level: "市", aliases: ["首尔", "Seoul", "汉城"] },
    "釜山": { lat: 35.1796, lng: 129.0756, level: "市", aliases: ["釜山", "Busan"] },
    "仁川": { lat: 37.4563, lng: 126.7052, level: "市", aliases: ["仁川", "Incheon"] },
    "大邱": { lat: 35.8714, lng: 128.6014, level: "市", aliases: ["大邱", "Daegu"] },
    "大田": { lat: 36.3504, lng: 127.3845, level: "市", aliases: ["大田", "Daejeon"] },
    "光州": { lat: 35.1595, lng: 126.8526, level: "市", aliases: ["光州", "Gwangju"] },
    "蔚山": { lat: 35.5384, lng: 129.3114, level: "市", aliases: ["蔚山", "Ulsan"] },
    "水原": { lat: 37.2636, lng: 127.0286, level: "市", aliases: ["水原", "Suwon"] }
  },

  "南非": {
    "约翰内斯堡": { lat: -26.2041, lng: 28.0473, level: "市", aliases: ["约翰内斯堡", "Johannesburg"] },
    "开普敦": { lat: -33.9249, lng: 18.4241, level: "市", aliases: ["开普敦", "Cape Town"] },
    "比勒陀利亚": { lat: -25.7479, lng: 28.2293, level: "市", aliases: ["比勒陀利亚", "Pretoria"] },
    "德班": { lat: -29.8587, lng: 31.0218, level: "市", aliases: ["德班", "Durban"] }
  },

  // === 欧洲主要国家与城市 ===
  "俄罗斯": {
    "莫斯科": { lat: 55.7558, lng: 37.6173, level: "市", aliases: ["莫斯科", "Moscow"] },
    "圣彼得堡": { lat: 59.9311, lng: 30.3609, level: "市", aliases: ["圣彼得堡", "Saint Petersburg", "St Petersburg"] },
    "新西伯利亚": { lat: 55.0084, lng: 82.9357, level: "市", aliases: ["新西伯利亚", "Novosibirsk"] },
    "叶卡捷琳堡": { lat: 56.8389, lng: 60.6057, level: "市", aliases: ["叶卡捷琳堡", "Yekaterinburg", "Ekaterinburg"] },
    "喀山": { lat: 55.7903, lng: 49.1125, level: "市", aliases: ["喀山", "Kazan"] },
    "下诺夫哥罗德": { lat: 56.2965, lng: 43.9361, level: "市", aliases: ["下诺夫哥罗德", "Nizhny Novgorod"] },
    "符拉迪沃斯托克": { lat: 43.1155, lng: 131.8855, level: "市", aliases: ["符拉迪沃斯托克", "Vladivostok"] }
  },
  "乌克兰": {
    "基辅": { lat: 50.4501, lng: 30.5234, level: "市", aliases: ["基辅", "Kyiv", "Kiev"] },
    "利沃夫": { lat: 49.8397, lng: 24.0297, level: "市", aliases: ["利沃夫", "Lviv", "Lwow"] },
    "敖德萨": { lat: 46.4825, lng: 30.7233, level: "市", aliases: ["敖德萨", "Odessa", "Odesa"] },
    "哈尔科夫": { lat: 49.9935, lng: 36.2304, level: "市", aliases: ["哈尔科夫", "Kharkiv"] },
    "第聂伯": { lat: 48.4647, lng: 35.0462, level: "市", aliases: ["第聂伯", "Dnipro"] }
  },
  "瑞士": {
    "苏黎世": { lat: 47.3769, lng: 8.5417, level: "市", aliases: ["苏黎世", "Zurich", "Zürich"] },
    "日内瓦": { lat: 46.2044, lng: 6.1432, level: "市", aliases: ["日内瓦", "Geneva"] },
    "巴塞尔": { lat: 47.5596, lng: 7.5886, level: "市", aliases: ["巴塞尔", "Basel"] },
    "伯尔尼": { lat: 46.9480, lng: 7.4474, level: "市", aliases: ["伯尔尼", "Bern", "Berne"] },
    "洛桑": { lat: 46.5197, lng: 6.6323, level: "市", aliases: ["洛桑", "Lausanne"] },
    "卢塞恩": { lat: 47.0502, lng: 8.3093, level: "市", aliases: ["卢塞恩", "Lucerne"] },
    "卢加诺": { lat: 46.0037, lng: 8.9511, level: "市", aliases: ["卢加诺", "Lugano"] }
  },
  // 奥地利
  "奥地利": {
    "维也纳": { lat: 48.2082, lng: 16.3738, level: "市", aliases: ["维也纳", "Vienna", "Wien"] },
    "萨尔茨堡": { lat: 47.8095, lng: 13.0550, level: "市", aliases: ["萨尔茨堡", "Salzburg"] },
    "格拉茨": { lat: 47.0707, lng: 15.4395, level: "市", aliases: ["格拉茨", "Graz"] },
    "林茨": { lat: 48.3069, lng: 14.2858, level: "市", aliases: ["林茨", "Linz"] },
    "因斯布鲁克": { lat: 47.2692, lng: 11.4041, level: "市", aliases: ["因斯布鲁克", "Innsbruck"] }
  },
  // 北欧
  "瑞典": {
    "斯德哥尔摩": { lat: 59.3293, lng: 18.0686, level: "市", aliases: ["斯德哥尔摩", "Stockholm"] },
    "哥德堡": { lat: 57.7089, lng: 11.9746, level: "市", aliases: ["哥德堡", "Gothenburg", "Göteborg"] },
    "马尔默": { lat: 55.60498, lng: 13.00382, level: "市", aliases: ["马尔默", "Malmö", "Malmo"] },
    "乌普萨拉": { lat: 59.8586, lng: 17.6389, level: "市", aliases: ["乌普萨拉", "Uppsala"] }
  },
  "挪威": {
    "奥斯陆": { lat: 59.9139, lng: 10.7522, level: "市", aliases: ["奥斯陆", "Oslo"] },
    "卑尔根": { lat: 60.3913, lng: 5.3221, level: "市", aliases: ["卑尔根", "Bergen"] },
    "特隆赫姆": { lat: 63.4305, lng: 10.3951, level: "市", aliases: ["特隆赫姆", "Trondheim"] },
    "斯塔万格": { lat: 58.969975, lng: 5.733107, level: "市", aliases: ["斯塔万格", "Stavanger"] }
  },
  "芬兰": {
    "赫尔辛基": { lat: 60.1699, lng: 24.9384, level: "市", aliases: ["赫尔辛基", "Helsinki"] },
    "坦佩雷": { lat: 61.4978, lng: 23.7610, level: "市", aliases: ["坦佩雷", "Tampere"] },
    "埃斯波": { lat: 60.2055, lng: 24.6559, level: "市", aliases: ["埃斯波", "Espoo"] }
  },
  "丹麦": {
    "哥本哈根": { lat: 55.6761, lng: 12.5683, level: "市", aliases: ["哥本哈根", "Copenhagen", "København"] },
    "奥胡斯": { lat: 56.1629, lng: 10.2039, level: "市", aliases: ["奥胡斯", "Aarhus"] },
    "欧登塞": { lat: 55.4038, lng: 10.4024, level: "市", aliases: ["欧登塞", "Odense"] }
  },
  // 西欧补充
  "葡萄牙": {
    "里斯本": { lat: 38.7223, lng: -9.1393, level: "市", aliases: ["里斯本", "Lisbon", "Lisboa"] },
    "波尔图": { lat: 41.1579, lng: -8.6291, level: "市", aliases: ["波尔图", "Porto", "Oporto"] },
    "科英布拉": { lat: 40.2033, lng: -8.4103, level: "市", aliases: ["科英布拉", "Coimbra"] },
    "法鲁": { lat: 37.0194, lng: -7.9304, level: "市", aliases: ["法鲁", "Faro"] }
  },
  "比利时": {
    "布鲁塞尔": { lat: 50.8503, lng: 4.3517, level: "市", aliases: ["布鲁塞尔", "Brussels", "Bruxelles"] },
    "安特卫普": { lat: 51.2194, lng: 4.4025, level: "市", aliases: ["安特卫普", "Antwerp", "Antwerpen"] },
    "根特": { lat: 51.0543, lng: 3.7174, level: "市", aliases: ["根特", "Ghent", "Gent"] },
    "列日": { lat: 50.6326, lng: 5.5797, level: "市", aliases: ["列日", "Liège", "Liege"] }
  },
  "波兰": {
    "华沙": { lat: 52.2297, lng: 21.0122, level: "市", aliases: ["华沙", "Warsaw", "Warszawa"] },
    "克拉科夫": { lat: 50.0647, lng: 19.9450, level: "市", aliases: ["克拉科夫", "Krakow", "Kraków"] },
    "弗罗茨瓦夫": { lat: 51.1079, lng: 17.0385, level: "市", aliases: ["弗罗茨瓦夫", "Wroclaw", "Wrocław"] },
    "格但斯克": { lat: 54.3520, lng: 18.6466, level: "市", aliases: ["格但斯克", "Gdansk", "Gdańsk"] },
    "波兹南": { lat: 52.4064, lng: 16.9252, level: "市", aliases: ["波兹南", "Poznan", "Poznań"] },
    "罗兹": { lat: 51.7592, lng: 19.4550, level: "市", aliases: ["罗兹", "Lodz", "Łódź"] }
  },
  "捷克": {
    "布拉格": { lat: 50.0755, lng: 14.4378, level: "市", aliases: ["布拉格", "Prague", "Praha"] },
    "布尔诺": { lat: 49.1951, lng: 16.6068, level: "市", aliases: ["布尔诺", "Brno"] }
  },
  "匈牙利": {
    "布达佩斯": { lat: 47.4979, lng: 19.0402, level: "市", aliases: ["布达佩斯", "Budapest"] },
    "德布勒森": { lat: 47.5316, lng: 21.6273, level: "市", aliases: ["德布勒森", "Debrecen"] },
    "塞格德": { lat: 46.2530, lng: 20.1414, level: "市", aliases: ["塞格德", "Szeged"] }
  },
  "希腊": {
    "雅典": { lat: 37.9838, lng: 23.7275, level: "市", aliases: ["雅典", "Athens"] },
    "塞萨洛尼基": { lat: 40.6401, lng: 22.9444, level: "市", aliases: ["塞萨洛尼基", "Thessaloniki"] }
  },
  "罗马尼亚": {
    "布加勒斯特": { lat: 44.4268, lng: 26.1025, level: "市", aliases: ["布加勒斯特", "Bucharest", "București"] }
  },
  "保加利亚": {
    "索非亚": { lat: 42.6977, lng: 23.3219, level: "市", aliases: ["索非亚", "Sofia"] }
  },
  "塞尔维亚": {
    "贝尔格莱德": { lat: 44.7866, lng: 20.4489, level: "市", aliases: ["贝尔格莱德", "Belgrade", "Beograd"] }
  },
  "克罗地亚": {
    "萨格勒布": { lat: 45.8150, lng: 15.9819, level: "市", aliases: ["萨格勒布", "Zagreb"] }
  },
  "斯洛文尼亚": {
    "卢布尔雅那": { lat: 46.0569, lng: 14.5058, level: "市", aliases: ["卢布尔雅那", "Ljubljana"] }
  },
  "斯洛伐克": {
    "布拉迪斯拉发": { lat: 48.1486, lng: 17.1077, level: "市", aliases: ["布拉迪斯拉发", "Bratislava"] }
  },
  "波斯尼亚和黑塞哥维那": {
    "萨拉热窝": { lat: 43.8563, lng: 18.4131, level: "市", aliases: ["萨拉热窝", "Sarajevo"] }
  },
  "北马其顿": {
    "斯科普里": { lat: 41.9981, lng: 21.4254, level: "市", aliases: ["斯科普里", "Skopje"] }
  },
  "阿尔巴尼亚": {
    "地拉那": { lat: 41.3275, lng: 19.8189, level: "市", aliases: ["地拉那", "Tirana"] }
  },
  "黑山": {
    "波德戈里察": { lat: 42.4304, lng: 19.2594, level: "市", aliases: ["波德戈里察", "Podgorica"] }
  },
  "科索沃": {
    "普里什蒂纳": { lat: 42.6629, lng: 21.1655, level: "市", aliases: ["普里什蒂纳", "Pristina", "Prishtina"] }
  },
  "立陶宛": {
    "维尔纽斯": { lat: 54.6872, lng: 25.2797, level: "市", aliases: ["维尔纽斯", "Vilnius"] }
  },
  "拉脱维亚": {
    "里加": { lat: 56.9496, lng: 24.1052, level: "市", aliases: ["里加", "Riga"] }
  },
  "爱沙尼亚": {
    "塔林": { lat: 59.4370, lng: 24.7536, level: "市", aliases: ["塔林", "Tallinn"] }
  },
  "爱尔兰": {
    "都柏林": { lat: 53.3498, lng: -6.2603, level: "市", aliases: ["都柏林", "Dublin"] },
    "科克": { lat: 51.8985, lng: -8.4756, level: "市", aliases: ["科克", "Cork"] },
    "戈尔韦": { lat: 53.2707, lng: -9.0568, level: "市", aliases: ["戈尔韦", "Galway"] }
  },
  "意大利": {
    "罗马": { lat: 41.9028, lng: 12.4964, level: "市", aliases: ["罗马", "Rome"] },
    "米兰": { lat: 45.4642, lng: 9.1900, level: "市", aliases: ["米兰", "Milan"] },
    "那不勒斯": { lat: 40.8518, lng: 14.2681, level: "市", aliases: ["那不勒斯", "Naples", "Napoli"] },
    "都灵": { lat: 45.0703, lng: 7.6869, level: "市", aliases: ["都灵", "Turin", "Torino"] },
    "佛罗伦萨": { lat: 43.7696, lng: 11.2558, level: "市", aliases: ["佛罗伦萨", "Florence", "Firenze"] },
    "威尼斯": { lat: 45.4408, lng: 12.3155, level: "市", aliases: ["威尼斯", "Venice", "Venezia"] },
    "博洛尼亚": { lat: 44.4949, lng: 11.3426, level: "市", aliases: ["博洛尼亚", "Bologna"] },
    "巴勒莫": { lat: 38.1157, lng: 13.3615, level: "市", aliases: ["巴勒莫", "Palermo"] }
  },
  "西班牙": {
    "马德里": { lat: 40.4168, lng: -3.7038, level: "市", aliases: ["马德里", "Madrid"] },
    "巴塞罗那": { lat: 41.3851, lng: 2.1734, level: "市", aliases: ["巴塞罗那", "Barcelona"] },
    "瓦伦西亚": { lat: 39.4699, lng: -0.3763, level: "市", aliases: ["瓦伦西亚", "Valencia"] },
    "塞维利亚": { lat: 37.3891, lng: -5.9845, level: "市", aliases: ["塞维利亚", "Seville", "Sevilla"] },
    "马拉加": { lat: 36.7213, lng: -4.4214, level: "市", aliases: ["马拉加", "Malaga", "Málaga"] },
    "萨拉戈萨": { lat: 41.6488, lng: -0.8891, level: "市", aliases: ["萨拉戈萨", "Zaragoza"] },
    "毕尔巴鄂": { lat: 43.2630, lng: -2.9350, level: "市", aliases: ["毕尔巴鄂", "Bilbao"] }
  },
  "英国": {
    "伦敦": { lat: 51.5074, lng: -0.1278, level: "市", aliases: ["伦敦", "London"] },
    "曼彻斯特": { lat: 53.4808, lng: -2.2426, level: "市", aliases: ["曼彻斯特", "Manchester"] },
    "伯明翰": { lat: 52.4862, lng: -1.8904, level: "市", aliases: ["伯明翰", "Birmingham"] },
    "爱丁堡": { lat: 55.9533, lng: -3.1883, level: "市", aliases: ["爱丁堡", "Edinburgh"] },
    "格拉斯哥": { lat: 55.8642, lng: -4.2518, level: "市", aliases: ["格拉斯哥", "Glasgow"] },
    "利物浦": { lat: 53.4084, lng: -2.9916, level: "市", aliases: ["利物浦", "Liverpool"] },
    "利兹": { lat: 53.8008, lng: -1.5491, level: "市", aliases: ["利兹", "Leeds"] },
    "布里斯托尔": { lat: 51.4545, lng: -2.5879, level: "市", aliases: ["布里斯托尔", "Bristol"] },
    "纽卡斯尔": { lat: 54.9783, lng: -1.6178, level: "市", aliases: ["纽卡斯尔", "Newcastle", "Newcastle upon Tyne"] },
    "牛津": { lat: 51.7520, lng: -1.2577, level: "市", aliases: ["牛津", "Oxford"] },
    "剑桥": { lat: 52.2053, lng: 0.1218, level: "市", aliases: ["剑桥", "Cambridge"] },
    "卡迪夫": { lat: 51.4816, lng: -3.1791, level: "市", aliases: ["卡迪夫", "Cardiff"] },
    "贝尔法斯特": { lat: 54.5973, lng: -5.9301, level: "市", aliases: ["贝尔法斯特", "Belfast"] }
  },
  "德国": {
    "柏林": { lat: 52.5200, lng: 13.4050, level: "市", aliases: ["柏林", "Berlin"] },
    "汉堡": { lat: 53.5511, lng: 9.9937, level: "市", aliases: ["汉堡", "Hamburg"] },
    "慕尼黑": { lat: 48.1351, lng: 11.5820, level: "市", aliases: ["慕尼黑", "Munich"] },
    "法兰克福": { lat: 50.1109, lng: 8.6821, level: "市", aliases: ["法兰克福", "Frankfurt"] },
    "科隆": { lat: 50.9375, lng: 6.9603, level: "市", aliases: ["科隆", "Cologne", "Köln"] },
    "斯图加特": { lat: 48.7758, lng: 9.1829, level: "市", aliases: ["斯图加特", "Stuttgart"] },
    "杜塞尔多夫": { lat: 51.2277, lng: 6.7735, level: "市", aliases: ["杜塞尔多夫", "Düsseldorf", "Dusseldorf"] },
    "多特蒙德": { lat: 51.5136, lng: 7.4653, level: "市", aliases: ["多特蒙德", "Dortmund"] },
    "埃森": { lat: 51.4556, lng: 7.0116, level: "市", aliases: ["埃森", "Essen"] },
    "莱比锡": { lat: 51.3397, lng: 12.3731, level: "市", aliases: ["莱比锡", "Leipzig"] },
    "德累斯顿": { lat: 51.0504, lng: 13.7373, level: "市", aliases: ["德累斯顿", "Dresden"] },
    "不来梅": { lat: 53.0793, lng: 8.8017, level: "市", aliases: ["不来梅", "Bremen"] },
    "汉诺威": { lat: 52.3759, lng: 9.7320, level: "市", aliases: ["汉诺威", "Hanover", "Hannover"] },
    "纽伦堡": { lat: 49.4521, lng: 11.0767, level: "市", aliases: ["纽伦堡", "Nuremberg", "Nürnberg"] }
  },
  "荷兰": {
    "阿姆斯特丹": { lat: 52.3676, lng: 4.9041, level: "市", aliases: ["阿姆斯特丹", "Amsterdam"] },
    "海牙": { lat: 52.0705, lng: 4.3007, level: "市", aliases: ["海牙", "The Hague"] },
    "鹿特丹": { lat: 51.9244, lng: 4.4777, level: "市", aliases: ["鹿特丹", "Rotterdam"] },
    "乌得勒支": { lat: 52.0907, lng: 5.1214, level: "市", aliases: ["乌得勒支", "Utrecht"] },
    "埃因霍温": { lat: 51.4416, lng: 5.4697, level: "市", aliases: ["埃因霍温", "Eindhoven"] },
    "格罗宁根": { lat: 53.2194, lng: 6.5665, level: "市", aliases: ["格罗宁根", "Groningen"] }
  },

  "土耳其": {
    "伊斯坦布尔": { lat: 41.0082, lng: 28.9784, level: "市", aliases: ["伊斯坦布尔", "Istanbul"] },
    "安卡拉": { lat: 39.9334, lng: 32.8597, level: "市", aliases: ["安卡拉", "Ankara"] },
    "伊兹密尔": { lat: 38.4237, lng: 27.1428, level: "市", aliases: ["伊兹密尔", "Izmir", "İzmir"] },
    "安塔利亚": { lat: 36.8969, lng: 30.7133, level: "市", aliases: ["安塔利亚", "Antalya"] },
    "布尔萨": { lat: 40.1950, lng: 29.0600, level: "市", aliases: ["布尔萨", "Bursa"] }
  },

  // === 高加索与中亚 ===
  "格鲁吉亚": {
    "第比利斯": { lat: 41.7151, lng: 44.8271, level: "市", aliases: ["第比利斯", "Tbilisi"] }
  },
  "亚美尼亚": {
    "埃里温": { lat: 40.1792, lng: 44.4991, level: "市", aliases: ["埃里温", "Yerevan"] }
  },
  "阿塞拜疆": {
    "巴库": { lat: 40.4093, lng: 49.8671, level: "市", aliases: ["巴库", "Baku"] }
  },
  "哈萨克斯坦": {
    "阿斯塔纳": { lat: 51.1694, lng: 71.4491, level: "市", aliases: ["阿斯塔纳", "Astana", "努尔苏丹", "Nur-Sultan"] },
    "阿拉木图": { lat: 43.2220, lng: 76.8512, level: "市", aliases: ["阿拉木图", "Almaty"] }
  },
  "乌兹别克斯坦": {
    "塔什干": { lat: 41.2995, lng: 69.2401, level: "市", aliases: ["塔什干", "Tashkent"] }
  },
  "吉尔吉斯斯坦": {
    "比什凯克": { lat: 42.8746, lng: 74.5698, level: "市", aliases: ["比什凯克", "Bishkek"] }
  },
  "塔吉克斯坦": {
    "杜尚别": { lat: 38.5598, lng: 68.7870, level: "市", aliases: ["杜尚别", "Dushanbe"] }
  },
  "土库曼斯坦": {
    "阿什哈巴德": { lat: 37.9601, lng: 58.3261, level: "市", aliases: ["阿什哈巴德", "Ashgabat"] }
  },
  "阿富汗": {
    "喀布尔": { lat: 34.5553, lng: 69.2075, level: "市", aliases: ["喀布尔", "Kabul"] }
  },

  // === 冰岛与小国 ===
  "冰岛": {
    "雷克雅未克": { lat: 64.1466, lng: -21.9426, level: "市", aliases: ["雷克雅未克", "Reykjavik", "Reykjavík"] }
  },
  "卢森堡": {
    "卢森堡市": { lat: 49.6116, lng: 6.1319, level: "市", aliases: ["卢森堡市", "Luxembourg City"] }
  },
  "摩纳哥": {
    "摩纳哥": { lat: 43.7384, lng: 7.4246, level: "市", aliases: ["摩纳哥", "Monaco"] }
  },
  "安道尔": {
    "安道尔城": { lat: 42.5063, lng: 1.5218, level: "市", aliases: ["安道尔城", "Andorra la Vella"] }
  },
  "马耳他": {
    "瓦莱塔": { lat: 35.8989, lng: 14.5146, level: "市", aliases: ["瓦莱塔", "Valletta"] }
  },
  "圣马力诺": {
    "圣马力诺市": { lat: 43.9356, lng: 12.4473, level: "市", aliases: ["圣马力诺市", "San Marino"] }
  },
  "塞浦路斯": {
    "尼科西亚": { lat: 35.1856, lng: 33.3823, level: "市", aliases: ["尼科西亚", "Nicosia"] }
  },

  // === 中东与北非 ===
  "阿联酋": {
    "迪拜": { lat: 25.2048, lng: 55.2708, level: "市", aliases: ["迪拜", "Dubai"] },
    "阿布扎比": { lat: 24.4539, lng: 54.3773, level: "市", aliases: ["阿布扎比", "Abu Dhabi"] },
    "沙迦": { lat: 25.3463, lng: 55.4209, level: "市", aliases: ["沙迦", "Sharjah"] }
  },
  "沙特阿拉伯": {
    "利雅得": { lat: 24.7136, lng: 46.6753, level: "市", aliases: ["利雅得", "Riyadh"] },
    "吉达": { lat: 21.4858, lng: 39.1925, level: "市", aliases: ["吉达", "Jeddah"] },
    "达曼": { lat: 26.4207, lng: 50.0888, level: "市", aliases: ["达曼", "Dammam"] }
  },
  "以色列": {
    "特拉维夫": { lat: 32.0853, lng: 34.7818, level: "市", aliases: ["特拉维夫", "Tel Aviv"] },
    "耶路撒冷": { lat: 31.7683, lng: 35.2137, level: "市", aliases: ["耶路撒冷", "Jerusalem"] },
    "海法": { lat: 32.7940, lng: 34.9896, level: "市", aliases: ["海法", "Haifa"] }
  },
  "伊朗": {
    "德黑兰": { lat: 35.6892, lng: 51.3890, level: "市", aliases: ["德黑兰", "Tehran"] },
    "马什哈德": { lat: 36.2605, lng: 59.6168, level: "市", aliases: ["马什哈德", "Mashhad"] },
    "伊斯法罕": { lat: 32.6546, lng: 51.6680, level: "市", aliases: ["伊斯法罕", "Isfahan"] },
    "设拉子": { lat: 29.5918, lng: 52.5837, level: "市", aliases: ["设拉子", "Shiraz"] }
  },
  "伊拉克": {
    "巴格达": { lat: 33.3152, lng: 44.3661, level: "市", aliases: ["巴格达", "Baghdad"] },
    "巴士拉": { lat: 30.5085, lng: 47.7804, level: "市", aliases: ["巴士拉", "Basra"] },
    "埃尔比勒": { lat: 36.1911, lng: 44.0092, level: "市", aliases: ["埃尔比勒", "Erbil"] }
  },
  "约旦": {
    "安曼": { lat: 31.9539, lng: 35.9106, level: "市", aliases: ["安曼", "Amman"] }
  },
  "黎巴嫩": {
    "贝鲁特": { lat: 33.8938, lng: 35.5018, level: "市", aliases: ["贝鲁特", "Beirut"] }
  },
  "卡塔尔": {
    "多哈": { lat: 25.2854, lng: 51.5310, level: "市", aliases: ["多哈", "Doha"] }
  },
  "科威特": {
    "科威特城": { lat: 29.3759, lng: 47.9774, level: "市", aliases: ["科威特城", "Kuwait City"] }
  },
  "巴林": {
    "麦纳麦": { lat: 26.2235, lng: 50.5876, level: "市", aliases: ["麦纳麦", "Manama"] }
  },
  "阿曼": {
    "马斯喀特": { lat: 23.5880, lng: 58.3829, level: "市", aliases: ["马斯喀特", "Muscat"] }
  },
  "也门": {
    "萨那": { lat: 15.3694, lng: 44.1910, level: "市", aliases: ["萨那", "Sanaa", "Sana'a"] },
    "亚丁": { lat: 12.7855, lng: 45.0187, level: "市", aliases: ["亚丁", "Aden"] }
  },
  "埃及": {
    "开罗": { lat: 30.0444, lng: 31.2357, level: "市", aliases: ["开罗", "Cairo"] },
    "亚历山大": { lat: 31.2001, lng: 29.9187, level: "市", aliases: ["亚历山大", "Alexandria"] }
  },
  "摩洛哥": {
    "卡萨布兰卡": { lat: 33.5731, lng: -7.5898, level: "市", aliases: ["卡萨布兰卡", "Casablanca"] },
    "拉巴特": { lat: 34.0209, lng: -6.8416, level: "市", aliases: ["拉巴特", "Rabat"] }
  },
  "尼日利亚": {
    "拉各斯": { lat: 6.5244, lng: 3.3792, level: "市", aliases: ["拉各斯", "Lagos"] },
    "阿布贾": { lat: 9.0765, lng: 7.3986, level: "市", aliases: ["阿布贾", "Abuja"] }
  },
  "肯尼亚": {
    "内罗毕": { lat: -1.2921, lng: 36.8219, level: "市", aliases: ["内罗毕", "Nairobi"] },
    "蒙巴萨": { lat: -4.0435, lng: 39.6682, level: "市", aliases: ["蒙巴萨", "Mombasa"] }
  },
  "埃塞俄比亚": {
    "亚的斯亚贝巴": { lat: 8.9806, lng: 38.7578, level: "市", aliases: ["亚的斯亚贝巴", "Addis Ababa"] }
  },
  "加纳": {
    "阿克拉": { lat: 5.6037, lng: -0.1870, level: "市", aliases: ["阿克拉", "Accra"] }
  },
  "坦桑尼亚": {
    "达累斯萨拉姆": { lat: -6.7924, lng: 39.2083, level: "市", aliases: ["达累斯萨拉姆", "Dar es Salaam"] }
  },
  "阿尔及利亚": {
    "阿尔及尔": { lat: 36.7538, lng: 3.0588, level: "市", aliases: ["阿尔及尔", "Algiers"] }
  },
  "突尼斯": {
    "突尼斯": { lat: 36.8065, lng: 10.1815, level: "市", aliases: ["突尼斯", "Tunis"] }
  },
  "利比亚": {
    "的黎波里": { lat: 32.8872, lng: 13.1913, level: "市", aliases: ["的黎波里", "Tripoli"] },
    "班加西": { lat: 32.1167, lng: 20.0667, level: "市", aliases: ["班加西", "Benghazi"] }
  },
  "苏丹": {
    "喀土穆": { lat: 15.5007, lng: 32.5599, level: "市", aliases: ["喀土穆", "Khartoum"] }
  },
  "乌干达": {
    "坎帕拉": { lat: 0.3476, lng: 32.5825, level: "市", aliases: ["坎帕拉", "Kampala"] }
  },
  "卢旺达": {
    "基加利": { lat: -1.9579, lng: 30.1127, level: "市", aliases: ["基加利", "Kigali"] }
  },
  "索马里": {
    "摩加迪沙": { lat: 2.0469, lng: 45.3182, level: "市", aliases: ["摩加迪沙", "Mogadishu"] }
  },
  "科特迪瓦": {
    "阿比让": { lat: 5.3453, lng: -4.0244, level: "市", aliases: ["阿比让", "Abidjan"] }
  },
  "塞内加尔": {
    "达喀尔": { lat: 14.7167, lng: -17.4677, level: "市", aliases: ["达喀尔", "Dakar"] }
  },
  "喀麦隆": {
    "雅温得": { lat: 3.8480, lng: 11.5021, level: "市", aliases: ["雅温得", "Yaounde", "Yaoundé"] },
    "杜阿拉": { lat: 4.0511, lng: 9.7679, level: "市", aliases: ["杜阿拉", "Douala"] }
  },
  "刚果（金）": {
    "金沙萨": { lat: -4.4419, lng: 15.2663, level: "市", aliases: ["金沙萨", "Kinshasa"] }
  },
  "刚果（布）": {
    "布拉柴维尔": { lat: -4.2634, lng: 15.2429, level: "市", aliases: ["布拉柴维尔", "Brazzaville"] }
  },
  "加蓬": {
    "利伯维尔": { lat: 0.4162, lng: 9.4673, level: "市", aliases: ["利伯维尔", "Libreville"] }
  },
  "安哥拉": {
    "罗安达": { lat: -8.8390, lng: 13.2894, level: "市", aliases: ["罗安达", "Luanda"] }
  },
  "纳米比亚": {
    "温得和克": { lat: -22.5609, lng: 17.0658, level: "市", aliases: ["温得和克", "Windhoek"] }
  },
  "博茨瓦纳": {
    "哈博罗内": { lat: -24.6282, lng: 25.9231, level: "市", aliases: ["哈博罗内", "Gaborone"] }
  },
  "津巴布韦": {
    "哈拉雷": { lat: -17.8252, lng: 31.0335, level: "市", aliases: ["哈拉雷", "Harare"] }
  },
  "赞比亚": {
    "卢萨卡": { lat: -15.3875, lng: 28.3228, level: "市", aliases: ["卢萨卡", "Lusaka"] }
  },
  "莫桑比克": {
    "马普托": { lat: -25.9692, lng: 32.5732, level: "市", aliases: ["马普托", "Maputo"] }
  },
  "马拉维": {
    "利隆圭": { lat: -13.9626, lng: 33.7741, level: "市", aliases: ["利隆圭", "Lilongwe"] }
  },
  "马达加斯加": {
    "塔那那利佛": { lat: -18.8792, lng: 47.5079, level: "市", aliases: ["塔那那利佛", "Antananarivo"] }
  },
  "毛里求斯": {
    "路易港": { lat: -20.1609, lng: 57.5012, level: "市", aliases: ["路易港", "Port Louis"] }
  },
  "塞舌尔": {
    "维多利亚": { lat: -4.6191, lng: 55.4513, level: "市", aliases: ["维多利亚", "Victoria"] }
  },

  // === 南亚 ===
  "印度": {
    "新德里": { lat: 28.6139, lng: 77.2090, level: "市", aliases: ["新德里", "New Delhi", "Delhi"] },
    "孟买": { lat: 19.0760, lng: 72.8777, level: "市", aliases: ["孟买", "Mumbai", "Bombay"] },
    "班加罗尔": { lat: 12.9716, lng: 77.5946, level: "市", aliases: ["班加罗尔", "Bengaluru", "Bangalore"] },
    "加尔各答": { lat: 22.5726, lng: 88.3639, level: "市", aliases: ["加尔各答", "Kolkata", "Calcutta"] },
    "金奈": { lat: 13.0827, lng: 80.2707, level: "市", aliases: ["金奈", "Chennai", "Madras"] },
    "海得拉巴": { lat: 17.3850, lng: 78.4867, level: "市", aliases: ["海得拉巴", "Hyderabad"] },
    "浦那": { lat: 18.5204, lng: 73.8567, level: "市", aliases: ["浦那", "Pune"] },
    "艾哈迈达巴德": { lat: 23.0225, lng: 72.5714, level: "市", aliases: ["艾哈迈达巴德", "Ahmedabad"] },
    "斋浦尔": { lat: 26.9124, lng: 75.7873, level: "市", aliases: ["斋浦尔", "Jaipur"] },
    "勒克瑙": { lat: 26.8467, lng: 80.9462, level: "市", aliases: ["勒克瑙", "Lucknow"] },
    "坎普尔": { lat: 26.4499, lng: 80.3319, level: "市", aliases: ["坎普尔", "Kanpur"] },
    "科钦": { lat: 9.9312, lng: 76.2673, level: "市", aliases: ["科钦", "Kochi", "Cochin"] }
  },
  "巴基斯坦": {
    "卡拉奇": { lat: 24.8607, lng: 67.0011, level: "市", aliases: ["卡拉奇", "Karachi"] },
    "拉合尔": { lat: 31.5204, lng: 74.3587, level: "市", aliases: ["拉合尔", "Lahore"] },
    "伊斯兰堡": { lat: 33.6844, lng: 73.0479, level: "市", aliases: ["伊斯兰堡", "Islamabad"] },
    "白沙瓦": { lat: 34.0151, lng: 71.5249, level: "市", aliases: ["白沙瓦", "Peshawar"] },
    "拉瓦尔品第": { lat: 33.6007, lng: 73.0679, level: "市", aliases: ["拉瓦尔品第", "Rawalpindi"] }
  },
  "孟加拉国": {
    "达卡": { lat: 23.8103, lng: 90.4125, level: "市", aliases: ["达卡", "Dhaka"] },
    "吉大港": { lat: 22.3569, lng: 91.7832, level: "市", aliases: ["吉大港", "Chittagong"] }
  },
  "斯里兰卡": {
    "科伦坡": { lat: 6.9271, lng: 79.8612, level: "市", aliases: ["科伦坡", "Colombo"] },
    "康提": { lat: 7.2906, lng: 80.6337, level: "市", aliases: ["康提", "Kandy"] }
  },
  "尼泊尔": {
    "加德满都": { lat: 27.7172, lng: 85.3240, level: "市", aliases: ["加德满都", "Kathmandu"] },
    "博卡拉": { lat: 28.2096, lng: 83.9856, level: "市", aliases: ["博卡拉", "Pokhara"] }
  },

  // === 拉丁美洲 ===
  "墨西哥": {
    "墨西哥城": { lat: 19.4326, lng: -99.1332, level: "市", aliases: ["墨西哥城", "Mexico City", "CDMX"] },
    "瓜达拉哈拉": { lat: 20.6597, lng: -103.3496, level: "市", aliases: ["瓜达拉哈拉", "Guadalajara"] },
    "蒙特雷": { lat: 25.6866, lng: -100.3161, level: "市", aliases: ["蒙特雷", "Monterrey"] },
    "普埃布拉": { lat: 19.0413, lng: -98.2062, level: "市", aliases: ["普埃布拉", "Puebla"] },
    "蒂华纳": { lat: 32.5149, lng: -117.0382, level: "市", aliases: ["蒂华纳", "Tijuana"] },
    "坎昆": { lat: 21.1619, lng: -86.8515, level: "市", aliases: ["坎昆", "Cancun", "Cancún"] },
    "梅里达": { lat: 20.9674, lng: -89.5926, level: "市", aliases: ["梅里达", "Merida", "Mérida"] }
  },
  "巴西": {
    "圣保罗": { lat: -23.5505, lng: -46.6333, level: "市", aliases: ["圣保罗", "Sao Paulo", "São Paulo"] },
    "里约热内卢": { lat: -22.9068, lng: -43.1729, level: "市", aliases: ["里约热内卢", "Rio de Janeiro", "Rio"] },
    "巴西利亚": { lat: -15.7939, lng: -47.8828, level: "市", aliases: ["巴西利亚", "Brasilia", "Brasília"] },
    "累西腓": { lat: -8.0476, lng: -34.8770, level: "市", aliases: ["累西腓", "Recife"] },
    "萨尔瓦多": { lat: -12.9777, lng: -38.5016, level: "市", aliases: ["萨尔瓦多", "Salvador"] },
    "福塔莱萨": { lat: -3.7319, lng: -38.5267, level: "市", aliases: ["福塔莱萨", "Fortaleza"] },
    "贝洛奥里藏特": { lat: -19.9167, lng: -43.9345, level: "市", aliases: ["贝洛奥里藏特", "Belo Horizonte"] },
    "库里提巴": { lat: -25.4284, lng: -49.2733, level: "市", aliases: ["库里提巴", "Curitiba"] },
    "阿雷格里港": { lat: -30.0346, lng: -51.2177, level: "市", aliases: ["阿雷格里港", "Porto Alegre"] },
    "马瑙斯": { lat: -3.1190, lng: -60.0217, level: "市", aliases: ["马瑙斯", "Manaus"] }
  },
  "阿根廷": {
    "布宜诺斯艾利斯": { lat: -34.6037, lng: -58.3816, level: "市", aliases: ["布宜诺斯艾利斯", "Buenos Aires"] },
    "科尔多瓦": { lat: -31.4201, lng: -64.1888, level: "市", aliases: ["科尔多瓦", "Cordoba", "Córdoba"] },
    "罗萨里奥": { lat: -32.9442, lng: -60.6505, level: "市", aliases: ["罗萨里奥", "Rosario"] }
  },
  "智利": {
    "圣地亚哥": { lat: -33.4489, lng: -70.6693, level: "市", aliases: ["圣地亚哥", "Santiago"] },
    "瓦尔帕莱索": { lat: -33.0472, lng: -71.6127, level: "市", aliases: ["瓦尔帕莱索", "Valparaiso", "Valparaíso"] }
  },
  "秘鲁": {
    "利马": { lat: -12.0464, lng: -77.0428, level: "市", aliases: ["利马", "Lima"] },
    "库斯科": { lat: -13.5319, lng: -71.9675, level: "市", aliases: ["库斯科", "Cusco", "Cuzco"] }
  },
  "哥伦比亚": {
    "波哥大": { lat: 4.7110, lng: -74.0721, level: "市", aliases: ["波哥大", "Bogota", "Bogotá"] },
    "麦德林": { lat: 6.2442, lng: -75.5812, level: "市", aliases: ["麦德林", "Medellin", "Medellín"] },
    "卡利": { lat: 3.4516, lng: -76.5320, level: "市", aliases: ["卡利", "Cali"] }
  },
  "厄瓜多尔": {
    "基多": { lat: -0.1807, lng: -78.4678, level: "市", aliases: ["基多", "Quito"] },
    "瓜亚基尔": { lat: -2.1700, lng: -79.9224, level: "市", aliases: ["瓜亚基尔", "Guayaquil"] }
  },
  "玻利维亚": {
    "拉巴斯": { lat: -16.4897, lng: -68.1193, level: "市", aliases: ["拉巴斯", "La Paz"] },
    "圣克鲁斯": { lat: -17.7833, lng: -63.1821, level: "市", aliases: ["圣克鲁斯", "Santa Cruz de la Sierra"] }
  },
  "乌拉圭": {
    "蒙得维的亚": { lat: -34.9011, lng: -56.1645, level: "市", aliases: ["蒙得维的亚", "Montevideo"] }
  },
  "巴拉圭": {
    "亚松森": { lat: -25.2637, lng: -57.5759, level: "市", aliases: ["亚松森", "Asuncion", "Asunción"] }
  },
  "委内瑞拉": {
    "加拉加斯": { lat: 10.4806, lng: -66.9036, level: "市", aliases: ["加拉加斯", "Caracas"] },
    "马拉开波": { lat: 10.6545, lng: -71.6533, level: "市", aliases: ["马拉开波", "Maracaibo"] }
  },

  // === 北美补充 ===
  "美国": {
    "旧金山": { lat: 37.7749, lng: -122.4194, level: "市", aliases: ["旧金山", "San Francisco", "三藩市"] },
    "洛杉矶": { lat: 34.0522, lng: -118.2437, level: "市", aliases: ["洛杉矶", "Los Angeles", "LA"] },
    "纽约": { lat: 40.7128, lng: -74.0060, level: "市", aliases: ["纽约", "New York", "NYC"] },
    "西雅图": { lat: 47.6062, lng: -122.3321, level: "市", aliases: ["西雅图", "Seattle"] },
    "波士顿": { lat: 42.3601, lng: -71.0589, level: "市", aliases: ["波士顿", "Boston"] },
    "芝加哥": { lat: 41.8781, lng: -87.6298, level: "市", aliases: ["芝加哥", "Chicago"] },
    "休斯顿": { lat: 29.7604, lng: -95.3698, level: "市", aliases: ["休斯顿", "Houston"] },
    "费城": { lat: 39.9526, lng: -75.1652, level: "市", aliases: ["费城", "Philadelphia"] },
    "拉斯维加斯": { lat: 36.1699, lng: -115.1398, level: "市", aliases: ["拉斯维加斯", "Las Vegas"] },
    "华盛顿": { lat: 38.9072, lng: -77.0369, level: "市", aliases: ["华盛顿", "Washington DC"] },
    "迈阿密": { lat: 25.7617, lng: -80.1918, level: "市", aliases: ["迈阿密", "Miami"] },
    "亚特兰大": { lat: 33.7490, lng: -84.3880, level: "市", aliases: ["亚特兰大", "Atlanta"] },
    "达拉斯": { lat: 32.7767, lng: -96.7970, level: "市", aliases: ["达拉斯", "Dallas"] },
    "奥斯汀": { lat: 30.2672, lng: -97.7431, level: "市", aliases: ["奥斯汀", "Austin"] },
    "圣安东尼奥": { lat: 29.4241, lng: -98.4936, level: "市", aliases: ["圣安东尼奥", "San Antonio"] },
    "菲尼克斯": { lat: 33.4484, lng: -112.0740, level: "市", aliases: ["菲尼克斯", "Phoenix"] },
    "圣迭戈": { lat: 32.7157, lng: -117.1611, level: "市", aliases: ["圣迭戈", "San Diego"] },
    "圣何塞": { lat: 37.3382, lng: -121.8863, level: "市", aliases: ["圣何塞", "San Jose"] },
    "丹佛": { lat: 39.7392, lng: -104.9903, level: "市", aliases: ["丹佛", "Denver"] },
    "底特律": { lat: 42.3314, lng: -83.0458, level: "市", aliases: ["底特律", "Detroit", "Motor City"] },
    "明尼阿波利斯": { lat: 44.9778, lng: -93.2650, level: "市", aliases: ["明尼阿波利斯", "Minneapolis"] },
    "圣保罗城": { lat: 44.9537, lng: -93.0900, level: "市", aliases: ["圣保罗城", "Saint Paul", "St. Paul"] },
    "波特兰": { lat: 45.5152, lng: -122.6784, level: "市", aliases: ["波特兰", "Portland"] },
    "萨克拉门托": { lat: 38.5816, lng: -121.4944, level: "市", aliases: ["萨克拉门托", "Sacramento"] },
    "巴尔的摩": { lat: 39.2904, lng: -76.6122, level: "市", aliases: ["巴尔的摩", "Baltimore"] },
    "夏洛特": { lat: 35.2271, lng: -80.8431, level: "市", aliases: ["夏洛特", "Charlotte"] },
    "纳什维尔": { lat: 36.1627, lng: -86.7816, level: "市", aliases: ["纳什维尔", "Nashville", "Music City"] },
    "新奥尔良": { lat: 29.9511, lng: -90.0715, level: "市", aliases: ["新奥尔良", "New Orleans"] },
    "盐湖城": { lat: 40.7608, lng: -111.8910, level: "市", aliases: ["盐湖城", "Salt Lake City"] },
    "堪萨斯城": { lat: 39.0997, lng: -94.5786, level: "市", aliases: ["堪萨斯城", "Kansas City"] },
    "圣路易斯": { lat: 38.6270, lng: -90.1994, level: "市", aliases: ["圣路易斯", "St. Louis"] },
    "印第安纳波利斯": { lat: 39.7684, lng: -86.1581, level: "市", aliases: ["印第安纳波利斯", "Indianapolis"] },
    "哥伦布": { lat: 39.9612, lng: -82.9988, level: "市", aliases: ["哥伦布", "Columbus"] },
    "克利夫兰": { lat: 41.4993, lng: -81.6944, level: "市", aliases: ["克利夫兰", "Cleveland"] },
    "匹兹堡": { lat: 40.4406, lng: -79.9959, level: "市", aliases: ["匹兹堡", "Pittsburgh"] },
    "奥兰多": { lat: 28.5383, lng: -81.3792, level: "市", aliases: ["奥兰多", "Orlando"] },
    "坦帕": { lat: 27.9506, lng: -82.4572, level: "市", aliases: ["坦帕", "Tampa"] },
    "檀香山": { lat: 21.3069, lng: -157.8583, level: "市", aliases: ["檀香山", "Honolulu"] },
    "安克雷奇": { lat: 61.2181, lng: -149.9003, level: "市", aliases: ["安克雷奇", "Anchorage"] }
  },
  "加拿大": {
    "温哥华": { lat: 49.2827, lng: -123.1207, level: "市", aliases: ["温哥华", "Vancouver"] },
    "多伦多": { lat: 43.6532, lng: -79.3832, level: "市", aliases: ["多伦多", "Toronto"] },
    "蒙特利尔": { lat: 45.5019, lng: -73.5674, level: "市", aliases: ["蒙特利尔", "Montreal", "Montréal"] },
    "卡尔加里": { lat: 51.0447, lng: -114.0719, level: "市", aliases: ["卡尔加里", "Calgary"] },
    "渥太华": { lat: 45.4215, lng: -75.6972, level: "市", aliases: ["渥太华", "Ottawa"] },
    "埃德蒙顿": { lat: 53.5461, lng: -113.4938, level: "市", aliases: ["埃德蒙顿", "Edmonton"] },
    "温尼伯": { lat: 49.8951, lng: -97.1384, level: "市", aliases: ["温尼伯", "Winnipeg"] },
    "魁北克城": { lat: 46.8139, lng: -71.2080, level: "市", aliases: ["魁北克城", "Quebec City", "Québec"] },
    "维多利亚": { lat: 48.4284, lng: -123.3656, level: "市", aliases: ["维多利亚", "Victoria"] },
    "哈利法克斯": { lat: 44.6488, lng: -63.5752, level: "市", aliases: ["哈利法克斯", "Halifax"] }
  },
  // === 中美洲与加勒比 ===
  "危地马拉": { "危地马拉城": { lat: 14.6349, lng: -90.5069, level: "市", aliases: ["危地马拉城", "Guatemala City"] } },
  "萨尔瓦多": { "圣萨尔瓦多": { lat: 13.6929, lng: -89.2182, level: "市", aliases: ["圣萨尔瓦多", "San Salvador"] } },
  "洪都拉斯": { "特古西加尔巴": { lat: 14.0723, lng: -87.1921, level: "市", aliases: ["特古西加尔巴", "Tegucigalpa"] } },
  "尼加拉瓜": { "马那瓜": { lat: 12.1140, lng: -86.2362, level: "市", aliases: ["马那瓜", "Managua"] } },
  "哥斯达黎加": { "圣何塞": { lat: 9.9281, lng: -84.0907, level: "市", aliases: ["圣何塞", "San Jose"] } },
  "巴拿马": { "巴拿马城": { lat: 8.9824, lng: -79.5199, level: "市", aliases: ["巴拿马城", "Panama City"] } },
  "古巴": { "哈瓦那": { lat: 23.1136, lng: -82.3666, level: "市", aliases: ["哈瓦那", "Havana"] } },
  "多米尼加": { "圣多明各": { lat: 18.4861, lng: -69.9312, level: "市", aliases: ["圣多明各", "Santo Domingo"] } },
  "波多黎各": { "圣胡安": { lat: 18.4655, lng: -66.1057, level: "市", aliases: ["圣胡安", "San Juan"] } },
  "巴哈马": { "拿骚": { lat: 25.0343, lng: -77.3963, level: "市", aliases: ["拿骚", "Nassau"] } },
  "牙买加": { "金斯敦": { lat: 17.9712, lng: -76.7936, level: "市", aliases: ["金斯敦", "Kingston"] } }
};

// 常见国家英文别名到中文键的映射（用于国际地址 disambiguation）
const COUNTRY_ALIASES = {
  // 北美
  'united states': '美国', 'usa': '美国', 'us': '美国', 'america': '美国',
  'canada': '加拿大',
  // 拉美
  'mexico': '墨西哥', 'brazil': '巴西', 'argentina': '阿根廷', 'chile': '智利',
  'peru': '秘鲁', 'colombia': '哥伦比亚', 'ecuador': '厄瓜多尔', 'bolivia': '玻利维亚',
  'uruguay': '乌拉圭', 'paraguay': '巴拉圭', 'venezuela': '委内瑞拉',
  'costa rica': '哥斯达黎加', 'panama': '巴拿马', 'guatemala': '危地马拉',
  'honduras': '洪都拉斯', 'nicaragua': '尼加拉瓜', 'el salvador': '萨尔瓦多',
  'cuba': '古巴', 'dominican republic': '多米尼加', 'puerto rico': '波多黎各',
  'bahamas': '巴哈马', 'jamaica': '牙买加',
  // 欧洲
  'united kingdom': '英国', 'uk': '英国', 'great britain': '英国', 'britain': '英国',
  'england': '英国', 'scotland': '英国', 'wales': '英国', 'northern ireland': '英国',
  'france': '法国', 'germany': '德国', 'netherlands': '荷兰', 'holland': '荷兰',
  'italy': '意大利', 'spain': '西班牙', 'portugal': '葡萄牙', 'belgium': '比利时',
  'switzerland': '瑞士', 'austria': '奥地利', 'sweden': '瑞典', 'norway': '挪威',
  'finland': '芬兰', 'denmark': '丹麦', 'poland': '波兰', 'czech': '捷克',
  'czechia': '捷克', 'hungary': '匈牙利', 'greece': '希腊', 'ireland': '爱尔兰',
  'iceland': '冰岛', 'russia': '俄罗斯', 'ukraine': '乌克兰', 'romania': '罗马尼亚',
  'bulgaria': '保加利亚', 'serbia': '塞尔维亚', 'croatia': '克罗地亚',
  'slovenia': '斯洛文尼亚', 'slovakia': '斯洛伐克', 'bosnia': '波斯尼亚和黑塞哥维那',
  'montenegro': '黑山', 'albania': '阿尔巴尼亚', 'kosovo': '科索沃',
  'lithuania': '立陶宛', 'latvia': '拉脱维亚', 'estonia': '爱沙尼亚',
  'luxembourg': '卢森堡', 'monaco': '摩纳哥', 'andorra': '安道尔', 'malta': '马耳他',
  'san marino': '圣马力诺', 'cyprus': '塞浦路斯',
  // 中东与高加索
  'turkey': '土耳其', 'türkiye': '土耳其', 'israel': '以色列', 'qatar': '卡塔尔',
  'kuwait': '科威特', 'bahrain': '巴林', 'oman': '阿曼', 'yemen': '也门',
  'iran': '伊朗', 'iraq': '伊拉克', 'jordan': '约旦', 'lebanon': '黎巴嫩',
  'uae': '阿联酋', 'united arab emirates': '阿联酋',
  'georgia': '格鲁吉亚', 'armenia': '亚美尼亚', 'azerbaijan': '阿塞拜疆',
  // 非洲
  'south africa': '南非', 'morocco': '摩洛哥', 'egypt': '埃及', 'nigeria': '尼日利亚',
  'kenya': '肯尼亚', 'ethiopia': '埃塞俄比亚', 'ghana': '加纳', 'tanzania': '坦桑尼亚',
  'algeria': '阿尔及利亚', 'tunisia': '突尼斯', 'libya': '利比亚', 'sudan': '苏丹',
  'uganda': '乌干达', 'rwanda': '卢旺达', 'somalia': '索马里', 'ivory coast': '科特迪瓦',
  'senegal': '塞内加尔', 'cameroon': '喀麦隆', 'dr congo': '刚果（金）',
  'drc': '刚果（金）', 'congo': '刚果（布）', 'gabon': '加蓬', 'angola': '安哥拉',
  'namibia': '纳米比亚', 'botswana': '博茨瓦纳', 'zimbabwe': '津巴布韦',
  'zambia': '赞比亚', 'mozambique': '莫桑比克', 'malawi': '马拉维',
  'madagascar': '马达加斯加', 'mauritius': '毛里求斯', 'seychelles': '塞舌尔',
  // 亚太
  'japan': '日本', 'south korea': '韩国', 'korea': '韩国', 'north korea': '朝鲜',
  'mongolia': '蒙古国', 'singapore': '新加坡', 'malaysia': '马来西亚',
  'thailand': '泰国', 'indonesia': '印度尼西亚', 'philippines': '菲律宾',
  'vietnam': '越南', 'cambodia': '柬埔寨', 'laos': '老挝', 'brunei': '文莱',
  'east timor': '东帝汶', 'timor-leste': '东帝汶', 'maldives': '马尔代夫',
  'india': '印度', 'pakistan': '巴基斯坦', 'bangladesh': '孟加拉国',
  'sri lanka': '斯里兰卡', 'nepal': '尼泊尔', 'bhutan': '不丹',
  // 大洋洲
  'australia': '澳大利亚', 'new zealand': '新西兰',
};

/**
 * 历史地名和别名映射表
 */
const HISTORICAL_NAMES = {
  // === 古代都城和历史地名 ===
  "燕京": "北京市",
  "大都": "北京市", 
  "北平": "北京市",
  "幽州": "北京市",
  "金陵": "南京市",
  "建康": "南京市",
  "应天府": "南京市",
  "白下": "南京市",
  "石头城": "南京市",
  "临安": "杭州市",
  "汴京": "开封市",
  "汴梁": "开封市",
  "长安": "西安市",
  "京师": "北京市",
  "奉天": "沈阳市",
  "盛京": "沈阳市",
  "和林": "呼和浩特市",
  "归绥": "呼和浩特市",
  "迪化": "乌鲁木齐市",
  "库伦": "乌兰巴托",
  
  // === 现代省份简称 ===
  "京": "北京市",
  "津": "天津市", 
  "沪": "上海市",
  "渝": "重庆市",
  "冀": "河北省",
  "晋": "山西省",
  "蒙": "内蒙古自治区",
  "辽": "辽宁省",
  "吉": "吉林省",
  "黑": "黑龙江省",
  "苏": "江苏省",
  "浙": "浙江省",
  "皖": "安徽省",
  "闽": "福建省",
  "赣": "江西省",
  "鲁": "山东省",
  "豫": "河南省",
  "鄂": "湖北省",
  "湘": "湖南省",
  "粤": "广东省",
  "桂": "广西壮族自治区",
  "琼": "海南省",
  "川": "四川省",
  "蜀": "四川省",
  "黔": "贵州省",
  "滇": "云南省",
  "藏": "西藏自治区",
  "陕": "陕西省",
  "秦": "陕西省",
  "甘": "甘肃省",
  "陇": "甘肃省",
  "青": "青海省",
  "宁": "宁夏回族自治区",
  "新": "新疆维吾尔自治区",
  "港": "香港特别行政区",
  "澳": "澳门特别行政区",
  "台": "台湾省",
  
  // === 城市简称和别名 ===
  "穗": "广州市",
  "深": "深圳市",
  "杭": "杭州市",
  "锡": "无锡市",
  "常": "常州市",
  "济": "济南市",
  "蓉": "成都市",
  "筑": "贵阳市",
  "昆": "昆明市",
  "邕": "南宁市",
  "榕": "福州市",
  "厦": "厦门市",
  "洪": "南昌市",
  "汉": "武汉市",
  "长": "长沙市",
  "郑": "郑州市",
  "石": "石家庄市",
  
  // === 城市雅称和别名 ===
  "羊城": "广州市",
  "花城": "广州市",
  "五羊城": "广州市",
  "鹏城": "深圳市", 
  "泉城": "济南市",
  "山城": "重庆市",
  "雾都": "重庆市",
  "火炉": "重庆市",
  "春城": "昆明市",
  "日光城": "拉萨市",
  "冰城": "哈尔滨市",
  "星城": "长沙市",
  "江城": "武汉市",
  "九省通衢": "武汉市",
  "东方巴黎": "哈尔滨市",
  "东方莫斯科": "哈尔滨市",
  "北国春城": "长春市",
  "塞上明珠": "呼和浩特市",
  "青城": "呼和浩特市",
  "草原钢城": "包头市",
  "丝绸之路明珠": "兰州市",
  "金城": "兰州市",
  "天府之国": "成都市",
  "锦城": "成都市",
  "芙蓉城": "成都市",
  "椰城": "海口市",
  "鹿城": "三亚市",
  "绿城": "南宁市",
  
  // === 港澳台别名 ===
  "东方之珠": "香港",
  "购物天堂": "香港",
  "亚洲四小龙": "香港",
  "赌城": "澳门",
  "东方蒙特卡洛": "澳门",
  "福尔摩沙": "台湾",
  "宝岛": "台湾",
  "美丽岛": "台湾",
  
  // === 海外华人聚居地别名 ===
  "狮城": "新加坡",
  "星洲": "新加坡",
  "花园城市": "新加坡",
  
  // === 常见外地中文音译 → 英文名 + 国家（用于 all-the-cities 兜底）===
  "科采列沃": "Koceljeva, Serbia",
  "三藩市": "旧金山",
  "金山": "旧金山",
  "天使之城": "洛杉矶",
  "大苹果": "纽约",
  "不夜城": "纽约",
  "风城": "芝加哥",
  "汽车城": "底特律",
  "音乐之城": "纳什维尔",
  "太空城": "休斯顿",
  // "赌城": "拉斯维加斯", // 与澳门别名冲突，避免歧义
  "罪恶之城": "拉斯维加斯",
  "枫叶之国": "加拿大",
  // "雾都": "伦敦", // 与重庆市别名冲突，避免歧义
  "光明之城": "巴黎",
  "浪漫之都": "巴黎",
  "永恒之城": "罗马",
  "时尚之都": "米兰",
  "音乐之都": "维也纳",
  "啤酒之都": "慕尼黑",
  "袋鼠国": "澳大利亚",
  "悉尼歌剧院": "悉尼",
  "花园之州": "新西兰",
  "长白云之乡": "新西兰",
  "樱花之国": "日本",
  "富士山": "日本",
  "汉城": "首尔",
  "泡菜国": "韩国",
  "彩虹之国": "南非"
};

/**
 * 地理位置查询服务类
 */
export class GeoLookupService {
  constructor() {
    this.allRegions = { ...CHINA_REGIONS, ...OVERSEAS_CHINESE_REGIONS };
    this.historicalNames = HISTORICAL_NAMES;
    this.countryAliases = COUNTRY_ALIASES;
    this.cityExactMap = new Map();
    this.cityBuckets = new Map();
    this.allCityRecords = [];

    // 可选：尝试加载 all-the-cities 作为补充（未安装时忽略）
    this._require = createRequire(import.meta.url);
    // 作为必备补充数据源加载（未安装则抛错，阻止启动）
    // all-the-cities 为 CJS 包，使用 require 同步加载
    try {
      this.allCities = this._require('all-the-cities');
      this.buildCityIndexes();
    } catch (e) {
      throw new Error('缺少依赖 all-the-cities，请运行 npm i all-the-cities 安装后重试');
    }

    // 启动日志：打印全局城市数据加载情况
    try {
      const count = this.allCityRecords.length;
      logger.info(`[GeoLookup] all-the-cities 已加载：${count} 个城市（全球补充数据源）`);
    } catch (_) {
      /* noop */
    }
  }

  buildCityIndexes() {
    if (!Array.isArray(this.allCities)) {
      return;
    }
    this.allCityRecords = [];
    this.cityExactMap.clear();
    this.cityBuckets.clear();

    for (const rec of this.allCities) {
      const matchNames = [rec.name, rec.name_ascii, rec.adminName]
        .filter(Boolean)
        .map((value) => this.sanitizeForMatch(String(value)))
        .filter(Boolean);

      const indexedRecord = { ...rec, _matchNames: matchNames };
      this.allCityRecords.push(indexedRecord);

      const uniqueKeys = new Set(matchNames);
      uniqueKeys.forEach((key) => {
        if (!key) return;
        if (!this.cityExactMap.has(key)) {
          this.cityExactMap.set(key, []);
        }
        this.cityExactMap.get(key).push(indexedRecord);

        const bucketKey = key.slice(0, 2) || key;
        if (!this.cityBuckets.has(bucketKey)) {
          this.cityBuckets.set(bucketKey, []);
        }
        this.cityBuckets.get(bucketKey).push(indexedRecord);
      });
    }
  }

  /**
   * 查询地理位置
   * @param {string} address - 地址字符串
   * @returns {Object} 查询结果
   */
  lookupAddress(address) {
    try {
      if (!address || typeof address !== 'string') {
        throw new Error('地址参数无效');
      }

      // 预处理地址
      const normalizedAddress = this.normalizeAddress(address);
      
      // 历史地名转换
      const modernAddress = this.convertHistoricalNames(normalizedAddress);

      // 尝试不同的匹配策略
      const looksInternational = /[,，]/.test(modernAddress) || /[A-Za-z].*\s+[A-Za-z]/.test(modernAddress);
      let result = null;
      if (looksInternational) {
        result = this.exactMatch(modernAddress) ||
                 this.hierarchyMatch(modernAddress) ||
                 this.internationalMatch(modernAddress) ||
                 this.aliasMatch(modernAddress) ||
                 this.allCitiesMatch(modernAddress) ||
                 this.fuzzyMatch(modernAddress);
      } else {
        result = this.exactMatch(modernAddress) ||
                 this.hierarchyMatch(modernAddress) ||
                 this.aliasMatch(modernAddress) ||
                 this.internationalMatch(modernAddress) ||
                 this.allCitiesMatch(modernAddress) ||
                 this.fuzzyMatch(modernAddress);
      }

      if (result) {
        return {
          success: true,
          data: {
            inputAddress: address,
            standardName: result.standardName,
            latitude: result.lat,
            longitude: result.lng,
            level: result.level,
            province: result.province,
            city: result.city,
            district: result.district,
            confidence: result.confidence || 1.0
          }
        };
      }

      throw new Error(`未找到地址: ${address}`);
    } catch (error) {
      return {
        success: false,
        error: error.message,
        data: null
      };
    }
  }

  /**
   * 地址标准化
   * @param {string} address - 原始地址
   * @returns {string} 标准化后的地址
   */
  normalizeAddress(address) {
    return address
      .trim()
      // 保留国际地址中的分隔符，匹配时统一用自定义归一化
      .replace(/[\u3000]+/g, ' ')
      .replace(/市$/, '市')  // 确保市字正确
      .replace(/省$/, '省')  // 确保省字正确
      .replace(/区$/, '区')  // 确保区字正确
      .replace(/县$/, '县'); // 确保县字正确
  }

  /**
   * 文本归一化（用于匹配，大小写/空白/标点/重音符统一处理）
   * @param {string} text
   * @returns {string}
   */
  sanitizeForMatch(text) {
    if (!text) return '';
    return text
      .toLowerCase()
      .normalize('NFD')
      .replace(/[\u0300-\u036f]/g, '') // 去除重音符号
      .replace(/[\s,_./\\\-]+/g, '')  // 移除常见分隔符
      .replace(/[()]/g, '')
      .trim();
  }

  /**
   * 历史地名转换
   * @param {string} address - 地址
   * @returns {string} 转换后的地址
   */
  convertHistoricalNames(address) {
    // 按照长度降序排列，避免短的关键词误匹配长地名的一部分
    const sortedEntries = Object.entries(this.historicalNames)
      .sort(([a], [b]) => b.length - a.length);
    
    for (const [historical, modern] of sortedEntries) {
      // 使用完整词匹配，避免部分字符匹配
      if (address === historical) {
        return modern;
      }
    }
    return address;
  }

  /**
   * 精确匹配
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  exactMatch(address) {
    const addressKey = this.sanitizeForMatch(address);
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        const fullName = province === city ? city : `${province}${city}`;
        // 检查完整地名、城市名（归一化比较）
        if (addressKey === this.sanitizeForMatch(fullName) || addressKey === this.sanitizeForMatch(city)) {
          return {
            ...data,
            standardName: fullName,
            province: province,
            city: city,
            district: data.level === '区' ? city : null,
            confidence: 1.0
          };
        }
        
        // 检查别名
        if (data.aliases) {
          for (const alias of data.aliases) {
            if (addressKey === this.sanitizeForMatch(alias)) {
              return {
                ...data,
                standardName: fullName,
                province: province,
                city: city,
                district: data.level === '区' ? city : null,
                confidence: 1.0
              };
            }
          }
        }
      }
    }
    return null;
  }

  /**
   * 层级匹配 (省->市->区)
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  hierarchyMatch(address) {
    // 提取省市区信息
    const provinceMatch = address.match(/(.+?省)/);
    const cityMatch = address.match(/(.+?市)/);
    const districtMatch = address.match(/(.+?[区县])/);

    if (provinceMatch) {
      const province = provinceMatch[1];
      if (this.allRegions[province]) {
        // 如果有市信息
        if (cityMatch) {
          const city = cityMatch[1];
          if (this.allRegions[province][city]) {
            return {
              ...this.allRegions[province][city],
              standardName: `${province}${city}`,
              province: province,
              city: city,
              district: null,
              confidence: 0.9
            };
          }
        }
        // 返回省会城市
        const provincialCapital = Object.values(this.allRegions[province])[0];
        if (provincialCapital) {
          return {
            ...provincialCapital,
            standardName: province,
            province: province,
            city: Object.keys(this.allRegions[province])[0],
            district: null,
            confidence: 0.7
          };
        }
      }
    }

    return null;
  }

  /**
   * 国际地址格式匹配，如 "Paris, France" 或 "France Paris"
   * 尝试先匹配城市别名，再在相同国家下偏好返回；若无法判定国家则返回第一个城市匹配
   * @param {string} address
   * @returns {Object|null}
   */
  internationalMatch(address) {
    const addrKey = this.sanitizeForMatch(address);
    // 候选分隔
    const parts = address.split(/[,，]/).map(s => s.trim()).filter(Boolean);
    // 尝试识别国家
    let matchedCountry = null;
    const addrLower = address.toLowerCase();
    for (const [alias, cn] of Object.entries(COUNTRY_ALIASES)) {
      if (addrLower.includes(alias)) {
        matchedCountry = cn;
        break;
      }
    }
    // 优先按别名/城市名匹配
    let cityHit = this.aliasMatch(address) || this.exactMatch(address);
    if (cityHit && parts.length <= 1) {
      if (matchedCountry && cityHit.province !== matchedCountry && this.allRegions[matchedCountry]) {
        const pkFull = this.sanitizeForMatch(address);
        for (const [city, data] of Object.entries(this.allRegions[matchedCountry])) {
          const aliases = [city, ...(data.aliases || [])];
          for (const al of aliases) {
            const ak = this.sanitizeForMatch(al);
            if (!ak) continue;
            const hit = ak.length <= 2 ? (pkFull === ak) : pkFull.includes(ak);
            if (hit) {
              return {
                ...data,
                standardName: matchedCountry === city ? city : `${matchedCountry}${city}`,
                province: matchedCountry,
                city,
                district: data.level === '区' ? city : null,
                confidence: 0.95
              };
            }
          }
        }
      }
      return cityHit;
    }
    // 若已命中城市但与识别的国家不一致，优先在该国家范围内再尝试一次
    if (cityHit && matchedCountry && cityHit.province !== matchedCountry) {
      const pkFull = parts.length > 1 ? this.sanitizeForMatch(parts[0]) : this.sanitizeForMatch(address);
      if (this.allRegions[matchedCountry]) {
        for (const [city, data] of Object.entries(this.allRegions[matchedCountry])) {
          const aliases = [city, ...(data.aliases || [])];
          for (const al of aliases) {
            const ak = this.sanitizeForMatch(al);
            if (!ak) continue;
            const hit = ak.length <= 2 ? (pkFull === ak) : pkFull.includes(ak);
            if (hit) {
              return {
                ...data,
                standardName: matchedCountry === city ? city : `${matchedCountry}${city}`,
                province: matchedCountry,
                city,
                district: data.level === '区' ? city : null,
                confidence: 0.95
              };
            }
          }
        }
      }
      // 未能在指定国家找到更精确的，则继续后续逻辑
    }

    if (!cityHit && parts.length > 1) {
      // 尝试分别匹配每一段，哪段像城市就返回
      for (const p of parts) {
        // 若识别到国家，优先在该国范围内匹配城市
        if (matchedCountry && this.allRegions[matchedCountry]) {
          const pk = this.sanitizeForMatch(p);
          for (const [city, data] of Object.entries(this.allRegions[matchedCountry])) {
            const aliases = [city, ...(data.aliases || [])];
            for (const al of aliases) {
              const ak = this.sanitizeForMatch(al);
              if (!ak) continue;
              const hit = ak.length <= 2 ? (pk === ak) : pk.includes(ak);
              if (hit) {
                return {
                  ...data,
                  standardName: matchedCountry === city ? city : `${matchedCountry}${city}`,
                  province: matchedCountry,
                  city,
                  district: data.level === '区' ? city : null,
                  confidence: 0.9
                };
              }
            }
          }
        }
        const hit = this.aliasMatch(p) || this.exactMatch(p);
        if (hit) return hit;
      }
    }

    // 最后尝试以空格分割的模式，如 "New York USA"
    const spaceParts = address.split(/[\s]+/).map(s => s.trim()).filter(Boolean);
    if (!cityHit && spaceParts.length > 1) {
      for (const p of spaceParts) {
        if (matchedCountry && this.allRegions[matchedCountry]) {
          const pk = this.sanitizeForMatch(p);
          for (const [city, data] of Object.entries(this.allRegions[matchedCountry])) {
            const aliases = [city, ...(data.aliases || [])];
            for (const al of aliases) {
              const ak = this.sanitizeForMatch(al);
              if (!ak) continue;
              const hit = ak.length <= 2 ? (pk === ak) : pk.includes(ak);
              if (hit) {
                return {
                  ...data,
                  standardName: matchedCountry === city ? city : `${matchedCountry}${city}`,
                  province: matchedCountry,
                  city,
                  district: data.level === '区' ? city : null,
                  confidence: 0.9
                };
              }
            }
          }
        }
        const hit = this.aliasMatch(p) || this.exactMatch(p);
        if (hit) return hit;
      }
    }
    // 兜底：按整体别名匹配（宽松包含），但避免超短别名误命中
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        const aliases = [city, ...(data.aliases || [])];
        for (const al of aliases) {
          const ak = this.sanitizeForMatch(al);
          if (!ak) continue;
          const hit = ak.length <= 2 ? (addrKey === ak) : addrKey.includes(ak);
          if (hit) {
            return {
              ...data,
              standardName: province === city ? city : `${province}${city}`,
              province,
              city,
              district: data.level === '区' ? city : null,
              confidence: 0.7
            };
          }
        }
      }
    }
    return null;
  }

  /**
   * 使用 all-the-cities 作为补充数据源
   * @param {string} address
   * @returns {Object|null}
   */
  allCitiesMatch(address) {
    try {
      if (!this.allCityRecords.length) return null;

      const addrLower = address.toLowerCase();
      const addrKey = this.sanitizeForMatch(address);
      if (!addrKey) return null;

      let matchedCountryCn = null;
      let matchedCountryAliasEn = null;
      for (const [aliasEn, cn] of Object.entries(this.countryAliases || {})) {
        if (addrLower.includes(aliasEn)) {
          matchedCountryCn = cn;
          matchedCountryAliasEn = aliasEn;
          break;
        }
      }

      const parts = address.split(/[,，]/).map((s) => s.trim()).filter(Boolean);
      let cityToken = parts.length > 0 ? parts[0] : address;
      if (parts.length > 1 && matchedCountryAliasEn && parts[0].toLowerCase().includes(matchedCountryAliasEn)) {
        cityToken = parts[1];
      }
      const cityKey = this.sanitizeForMatch(cityToken);
      if (!cityKey) return null;

      const candidates = this.lookupCityCandidates(cityKey);
      if (!candidates.length) return null;

      let best = null;
      let bestScore = 0;

      for (const rec of candidates) {
        const names = rec._matchNames || [];
        let localScore = 0;
        for (const nk of names) {
          const score = this.calculateSimilarity(cityKey, nk);
          if (score > localScore) localScore = score;
        }
        if (localScore < 0.7) continue;

        let countryBoost = 0;
        if (matchedCountryAliasEn) {
          const aliasKey = this.sanitizeForMatch(matchedCountryAliasEn);
          const recCountryKey = this.sanitizeForMatch(String(rec.country));
          if (recCountryKey === aliasKey) {
            countryBoost = 0.15;
          } else if (rec.iso2 && this.sanitizeForMatch(rec.iso2) === aliasKey) {
            countryBoost = 0.15;
          } else if (rec.iso3 && this.sanitizeForMatch(rec.iso3) === aliasKey) {
            countryBoost = 0.15;
          }
        }

        const totalScore = Math.min(1, localScore + countryBoost);
        if (totalScore > bestScore) {
          bestScore = totalScore;
          best = rec;
        }
      }

      if (!best) return null;

      const province = matchedCountryCn || best.country;
      const standardName = `${province}${best.name}`;
      return {
        lat: Number(best.lat),
        lng: Number(best.lon),
        level: '市',
        aliases: [best.name, best.name_ascii].filter(Boolean),
        standardName,
        province,
        city: best.name,
        district: null,
        confidence: bestScore
      };
    } catch (e) {
      return null;
    }
  }

  lookupCityCandidates(cityKey) {
    if (!cityKey) {
      return [];
    }

    const exactMatches = this.cityExactMap.get(cityKey);
    if (exactMatches && exactMatches.length) {
      return exactMatches;
    }

    const bucketKey = cityKey.slice(0, 2) || cityKey;
    const bucketMatches = this.cityBuckets.get(bucketKey);
    if (bucketMatches && bucketMatches.length) {
      return bucketMatches;
    }

    const shortKey = cityKey.slice(0, 1);
    const shortMatches = this.cityBuckets.get(shortKey);
    if (shortMatches && shortMatches.length) {
      return shortMatches;
    }

    return this.allCityRecords;
  }

  /**
   * 别名匹配
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  aliasMatch(address) {
    const addressKey = this.sanitizeForMatch(address);
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        if (data.aliases) {
          for (const alias of data.aliases) {
            const aliasKey = this.sanitizeForMatch(alias);
            if (!aliasKey) continue;
            // 避免超短别名（如“LA”）误命中，例如 "Switzerland" 包含 "la"
            const hit = aliasKey.length <= 2
              ? (addressKey === aliasKey)
              : addressKey.includes(aliasKey);
            if (hit) {
              return {
                ...data,
                standardName: `${province}${city}`,
                province: province,
                city: city,
                district: data.level === '区' ? city : null,
                confidence: 0.8
              };
            }
          }
        }
      }
    }
    return null;
  }

  /**
   * 模糊匹配
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  fuzzyMatch(address) {
    let bestMatch = null;
    let bestScore = 0;

    const addrKey = this.sanitizeForMatch(address);
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        const fullName = province === city ? city : `${province}${city}`;
        const score = this.calculateSimilarity(addrKey, this.sanitizeForMatch(fullName));
        
        if (score > bestScore && score > 0.6) {
          bestScore = score;
          bestMatch = {
            ...data,
            standardName: fullName,
            province: province,
            city: city,
            district: data.level === '区' ? city : null,
            confidence: score
          };
        }

        // 也检查城市名本身
        const cityScore = this.calculateSimilarity(addrKey, this.sanitizeForMatch(city));
        if (cityScore > bestScore && cityScore > 0.6) {
          bestScore = cityScore;
          bestMatch = {
            ...data,
            standardName: fullName,
            province: province,
            city: city,
            district: data.level === '区' ? city : null,
            confidence: cityScore
          };
        }
      }
    }

    return bestMatch;
  }

  /**
   * 计算字符串相似度
   * @param {string} str1 - 字符串1
   * @param {string} str2 - 字符串2
   * @returns {number} 相似度 (0-1)
   */
  calculateSimilarity(str1, str2) {
    const longer = str1.length > str2.length ? str1 : str2;
    const shorter = str1.length > str2.length ? str2 : str1;
    
    if (longer.length === 0) return 1.0;
    
    const distance = this.levenshteinDistance(longer, shorter);
    return (longer.length - distance) / longer.length;
  }

  // 坐标直输功能已移除（根据产品需求不提供）

  /**
   * 计算编辑距离 (Levenshtein Distance)
   * @param {string} str1 - 字符串1
   * @param {string} str2 - 字符串2
   * @returns {number} 编辑距离
   */
  levenshteinDistance(str1, str2) {
    const matrix = [];

    for (let i = 0; i <= str2.length; i++) {
      matrix[i] = [i];
    }

    for (let j = 0; j <= str1.length; j++) {
      matrix[0][j] = j;
    }

    for (let i = 1; i <= str2.length; i++) {
      for (let j = 1; j <= str1.length; j++) {
        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
          matrix[i][j] = matrix[i - 1][j - 1];
        } else {
          matrix[i][j] = Math.min(
            matrix[i - 1][j - 1] + 1, // substitution
            matrix[i][j - 1] + 1,     // insertion
            matrix[i - 1][j] + 1      // deletion
          );
        }
      }
    }

    return matrix[str2.length][str1.length];
  }

  /**
   * 获取支持的地区列表
   * @returns {Array} 地区列表
   */
  getSupportedRegions() {
    const regions = [];
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        regions.push({
          province,
          city,
          level: data.level,
          latitude: data.lat,
          longitude: data.lng,
          aliases: data.aliases || []
        });
      }
    }
    return regions;
  }
}

// 导出单例实例
export const geoLookupService = new GeoLookupService();
