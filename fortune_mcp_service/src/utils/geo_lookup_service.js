/**
 * 地理位置查询服务
 * 实现中文地址到经纬度坐标的转换
 */

/**
 * 中国主要城市和地区坐标数据库
 */
const CHINA_REGIONS = {
  // 直辖市
  "北京市": {
    "北京市": { lat: 39.9042, lng: 116.4074, level: "市", aliases: ["京", "北京", "燕京"] },
    "东城区": { lat: 39.9289, lng: 116.4203, level: "区" },
    "西城区": { lat: 39.9139, lng: 116.3657, level: "区" },
    "朝阳区": { lat: 39.9209, lng: 116.4863, level: "区" },
    "丰台区": { lat: 39.8579, lng: 116.2868, level: "区" },
    "石景山区": { lat: 39.9056, lng: 116.1958, level: "区" },
    "海淀区": { lat: 39.9586, lng: 116.2980, level: "区" },
    "门头沟区": { lat: 39.9377, lng: 116.1068, level: "区" },
    "房山区": { lat: 39.7489, lng: 115.9884, level: "区" },
    "通州区": { lat: 39.9026, lng: 116.6574, level: "区" },
    "顺义区": { lat: 40.1282, lng: 116.6555, level: "区" },
    "昌平区": { lat: 40.2206, lng: 116.2352, level: "区" },
    "大兴区": { lat: 39.7287, lng: 116.3384, level: "区" },
    "怀柔区": { lat: 40.3242, lng: 116.6374, level: "区" },
    "平谷区": { lat: 40.1445, lng: 117.1114, level: "区" },
    "密云区": { lat: 40.3769, lng: 116.8432, level: "区" },
    "延庆区": { lat: 40.4652, lng: 115.9742, level: "区" }
  },
  
  "上海市": {
    "上海市": { lat: 31.2304, lng: 121.4737, level: "市", aliases: ["沪", "上海", "申"] },
    "黄浦区": { lat: 31.2246, lng: 121.4903, level: "区" },
    "徐汇区": { lat: 31.1886, lng: 121.4367, level: "区" },
    "长宁区": { lat: 31.2204, lng: 121.4197, level: "区" },
    "静安区": { lat: 31.2457, lng: 121.4489, level: "区" },
    "普陀区": { lat: 31.2497, lng: 121.3954, level: "区" },
    "虹口区": { lat: 31.2646, lng: 121.5050, level: "区" },
    "杨浦区": { lat: 31.2590, lng: 121.5219, level: "区" },
    "闵行区": { lat: 31.1123, lng: 121.3810, level: "区" },
    "宝山区": { lat: 31.4041, lng: 121.4896, level: "区" },
    "嘉定区": { lat: 31.3746, lng: 121.2655, level: "区" },
    "浦东新区": { lat: 31.2220, lng: 121.5367, level: "区" },
    "金山区": { lat: 30.7417, lng: 121.3300, level: "区" },
    "松江区": { lat: 31.0322, lng: 121.2267, level: "区" },
    "青浦区": { lat: 31.1516, lng: 121.1240, level: "区" },
    "奉贤区": { lat: 30.9177, lng: 121.4742, level: "区" },
    "崇明区": { lat: 31.6270, lng: 121.3972, level: "区" }
  },

  "天津市": {
    "天津市": { lat: 39.0842, lng: 117.2008, level: "市", aliases: ["津", "天津"] },
    "和平区": { lat: 39.1189, lng: 117.2006, level: "区" },
    "河东区": { lat: 39.1248, lng: 117.2263, level: "区" },
    "河西区": { lat: 39.1040, lng: 117.2168, level: "区" },
    "南开区": { lat: 39.1204, lng: 117.1647, level: "区" },
    "河北区": { lat: 39.1561, lng: 117.2057, level: "区" },
    "红桥区": { lat: 39.1661, lng: 117.1596, level: "区" }
  },

  "重庆市": {
    "重庆市": { lat: 29.5630, lng: 106.5516, level: "市", aliases: ["渝", "重庆", "山城"] },
    "渝中区": { lat: 29.5569, lng: 106.5697, level: "区" },
    "万州区": { lat: 30.8077, lng: 108.4086, level: "区" },
    "涪陵区": { lat: 29.7032, lng: 107.3943, level: "区" },
    "渝北区": { lat: 29.7181, lng: 106.6311, level: "区" },
    "沙坪坝区": { lat: 29.5412, lng: 106.4567, level: "区" },
    "九龙坡区": { lat: 29.5023, lng: 106.5109, level: "区" },
    "南岸区": { lat: 29.5237, lng: 106.5608, level: "区" },
    "北碚区": { lat: 29.8256, lng: 106.4378, level: "区" },
    "綦江区": { lat: 29.0282, lng: 106.6516, level: "区" },
    "大足区": { lat: 29.7007, lng: 105.7214, level: "区" },
    "黔江区": { lat: 29.5273, lng: 108.7703, level: "区" }
  },

  // 省份和主要城市
  "广东省": {
    "广州市": { lat: 23.1291, lng: 113.2644, level: "市", aliases: ["穗", "广州", "羊城"] },
    "深圳市": { lat: 22.5431, lng: 114.0579, level: "市", aliases: ["深圳", "鹏城"] },
    "珠海市": { lat: 22.2769, lng: 113.5678, level: "市" },
    "汕头市": { lat: 23.3547, lng: 116.6810, level: "市" },
    "佛山市": { lat: 23.0218, lng: 113.1219, level: "市" },
    "韶关市": { lat: 24.8016, lng: 113.5912, level: "市" },
    "湛江市": { lat: 21.2707, lng: 110.3594, level: "市" },
    "肇庆市": { lat: 23.0786, lng: 112.4702, level: "市" },
    "江门市": { lat: 22.5751, lng: 113.0818, level: "市" },
    "茂名市": { lat: 21.6631, lng: 110.9254, level: "市" },
    "惠州市": { lat: 23.1115, lng: 114.4152, level: "市" },
    "梅州市": { lat: 24.2886, lng: 116.1226, level: "市" },
    "汕尾市": { lat: 22.7787, lng: 115.3750, level: "市" },
    "河源市": { lat: 23.7341, lng: 114.6979, level: "市" },
    "阳江市": { lat: 21.8593, lng: 111.9823, level: "市" },
    "清远市": { lat: 23.6817, lng: 113.0538, level: "市" },
    "东莞市": { lat: 23.0209, lng: 113.7518, level: "市" },
    "中山市": { lat: 22.5177, lng: 113.3927, level: "市" },
    "潮州市": { lat: 23.6567, lng: 116.6309, level: "市" },
    "揭阳市": { lat: 23.5479, lng: 116.3729, level: "市" },
    "云浮市": { lat: 22.9155, lng: 112.0442, level: "市" }
  },

  "江苏省": {
    "南京市": { lat: 32.0603, lng: 118.7969, level: "市", aliases: ["宁", "南京", "金陵", "建康"] },
    "无锡市": { lat: 31.4912, lng: 120.3124, level: "市" },
    "徐州市": { lat: 34.2619, lng: 117.2848, level: "市" },
    "常州市": { lat: 31.7725, lng: 119.9462, level: "市" },
    "苏州市": { lat: 31.2989, lng: 120.5853, level: "市", aliases: ["苏州", "姑苏"] },
    "南通市": { lat: 32.0085, lng: 120.8647, level: "市" },
    "连云港市": { lat: 34.5962, lng: 119.1248, level: "市" },
    "淮安市": { lat: 33.5975, lng: 119.0153, level: "市" },
    "盐城市": { lat: 33.3775, lng: 120.1614, level: "市" },
    "扬州市": { lat: 32.3932, lng: 119.4217, level: "市" },
    "镇江市": { lat: 32.2044, lng: 119.4520, level: "市" },
    "泰州市": { lat: 32.4849, lng: 119.9153, level: "市" },
    "宿迁市": { lat: 33.9630, lng: 118.2757, level: "市" }
  },

  "浙江省": {
    "杭州市": { lat: 30.2741, lng: 120.1551, level: "市", aliases: ["杭", "杭州", "临安"] },
    "宁波市": { lat: 29.8683, lng: 121.5440, level: "市" },
    "温州市": { lat: 27.9943, lng: 120.6994, level: "市" },
    "嘉兴市": { lat: 30.7467, lng: 120.7507, level: "市" },
    "湖州市": { lat: 30.8936, lng: 120.0856, level: "市" },
    "绍兴市": { lat: 30.0023, lng: 120.5822, level: "市" },
    "金华市": { lat: 29.1028, lng: 119.6472, level: "市" },
    "衢州市": { lat: 28.9419, lng: 118.8732, level: "市" },
    "舟山市": { lat: 29.9853, lng: 122.2072, level: "市" },
    "台州市": { lat: 28.6568, lng: 121.4200, level: "市" },
    "丽水市": { lat: 28.4517, lng: 119.9219, level: "市" }
  },

  "山东省": {
    "济南市": { lat: 36.6512, lng: 117.1201, level: "市", aliases: ["济", "济南", "泉城"] },
    "青岛市": { lat: 36.0671, lng: 120.3826, level: "市" },
    "淄博市": { lat: 36.8133, lng: 118.0548, level: "市" },
    "枣庄市": { lat: 34.8103, lng: 117.3226, level: "市" },
    "东营市": { lat: 37.4616, lng: 118.6747, level: "市" },
    "烟台市": { lat: 37.4638, lng: 121.4475, level: "市" },
    "潍坊市": { lat: 36.7070, lng: 119.1615, level: "市" },
    "济宁市": { lat: 35.4156, lng: 116.5873, level: "市" },
    "泰安市": { lat: 36.1943, lng: 117.0888, level: "市" },
    "威海市": { lat: 37.5126, lng: 122.1200, level: "市" },
    "日照市": { lat: 35.4164, lng: 119.5269, level: "市" },
    "莱芜市": { lat: 36.2045, lng: 117.6571, level: "市" },
    "临沂市": { lat: 35.1041, lng: 118.3563, level: "市" },
    "德州市": { lat: 37.4608, lng: 116.3574, level: "市" },
    "聊城市": { lat: 36.4567, lng: 115.9857, level: "市" },
    "滨州市": { lat: 37.3835, lng: 117.9708, level: "市" },
    "菏泽市": { lat: 35.2336, lng: 115.4692, level: "市" }
  },

  // 添加缺失的省份
  "河北省": {
    "石家庄市": { lat: 38.0428, lng: 114.5149, level: "市", aliases: ["石家庄"] },
    "唐山市": { lat: 39.6351, lng: 118.1900, level: "市" },
    "秦皇岛市": { lat: 39.9353, lng: 119.6010, level: "市" },
    "邯郸市": { lat: 36.6123, lng: 114.4900, level: "市" },
    "邢台市": { lat: 37.0682, lng: 114.5086, level: "市" },
    "保定市": { lat: 38.8740, lng: 115.4648, level: "市" },
    "张家口市": { lat: 40.8110, lng: 114.8794, level: "市" },
    "承德市": { lat: 40.9542, lng: 117.9396, level: "市" },
    "沧州市": { lat: 38.3170, lng: 116.8579, level: "市" },
    "廊坊市": { lat: 39.5238, lng: 116.7049, level: "市" },
    "衡水市": { lat: 37.7348, lng: 115.6657, level: "市" }
  },

  "山西省": {
    "太原市": { lat: 37.8706, lng: 112.5489, level: "市", aliases: ["太原", "并州"] },
    "大同市": { lat: 40.0760, lng: 113.2950, level: "市" },
    "阳泉市": { lat: 37.8571, lng: 113.5833, level: "市" },
    "长治市": { lat: 36.1914, lng: 113.1132, level: "市" },
    "晋城市": { lat: 35.4977, lng: 112.8513, level: "市" },
    "朔州市": { lat: 39.3311, lng: 112.4332, level: "市" },
    "晋中市": { lat: 37.6872, lng: 112.7537, level: "市" },
    "运城市": { lat: 35.0228, lng: 111.0073, level: "市" },
    "忻州市": { lat: 38.4177, lng: 112.7340, level: "市" },
    "临汾市": { lat: 36.0881, lng: 111.5179, level: "市" },
    "吕梁市": { lat: 37.5177, lng: 111.1341, level: "市" }
  },

  "辽宁省": {
    "沈阳市": { lat: 41.8057, lng: 123.4315, level: "市", aliases: ["沈阳", "奉天"] },
    "大连市": { lat: 38.9140, lng: 121.6147, level: "市" },
    "鞍山市": { lat: 41.1106, lng: 122.9950, level: "市" },
    "抚顺市": { lat: 41.8773, lng: 123.9576, level: "市" },
    "本溪市": { lat: 41.2979, lng: 123.7705, level: "市" },
    "丹东市": { lat: 40.1290, lng: 124.3541, level: "市" },
    "锦州市": { lat: 41.1191, lng: 121.1353, level: "市" },
    "营口市": { lat: 40.6674, lng: 122.2352, level: "市" },
    "阜新市": { lat: 42.0118, lng: 121.6708, level: "市" },
    "辽阳市": { lat: 41.2693, lng: 123.1819, level: "市" },
    "盘锦市": { lat: 41.1245, lng: 122.0703, level: "市" },
    "铁岭市": { lat: 42.2908, lng: 123.8444, level: "市" },
    "朝阳市": { lat: 41.5768, lng: 120.4514, level: "市" },
    "葫芦岛市": { lat: 40.7560, lng: 120.8560, level: "市" }
  },

  "吉林省": {
    "长春市": { lat: 43.8171, lng: 125.3235, level: "市", aliases: ["长春", "春城"] },
    "吉林市": { lat: 43.8436, lng: 126.5528, level: "市" },
    "四平市": { lat: 43.1703, lng: 124.3505, level: "市" },
    "辽源市": { lat: 42.9027, lng: 125.1455, level: "市" },
    "通化市": { lat: 41.7211, lng: 125.9365, level: "市" },
    "白山市": { lat: 41.9425, lng: 126.4276, level: "市" },
    "松原市": { lat: 45.1412, lng: 124.8254, level: "市" },
    "白城市": { lat: 45.6196, lng: 122.8409, level: "市" },
    "延边朝鲜族自治州": { lat: 42.9048, lng: 129.5081, level: "州" }
  },

  "黑龙江省": {
    "哈尔滨市": { lat: 45.8038, lng: 126.5349, level: "市", aliases: ["哈尔滨", "冰城"] },
    "齐齐哈尔市": { lat: 47.3543, lng: 123.9182, level: "市" },
    "鸡西市": { lat: 45.2950, lng: 130.9750, level: "市" },
    "鹤岗市": { lat: 47.3324, lng: 130.2773, level: "市" },
    "双鸭山市": { lat: 46.6434, lng: 131.1572, level: "市" },
    "大庆市": { lat: 46.5901, lng: 125.1031, level: "市" },
    "伊春市": { lat: 47.7248, lng: 128.8992, level: "市" },
    "佳木斯市": { lat: 46.8108, lng: 130.3618, level: "市" },
    "七台河市": { lat: 45.7713, lng: 131.0154, level: "市" },
    "牡丹江市": { lat: 44.5831, lng: 129.6333, level: "市" },
    "黑河市": { lat: 50.2456, lng: 127.4993, level: "市" },
    "绥化市": { lat: 46.6374, lng: 126.9923, level: "市" },
    "大兴安岭地区": { lat: 52.3353, lng: 124.1116, level: "地区" }
  },

  "河南省": {
    "郑州市": { lat: 34.7466, lng: 113.6253, level: "市", aliases: ["郑州", "商都"] },
    "开封市": { lat: 34.7971, lng: 114.3075, level: "市", aliases: ["汴京", "汴梁"] },
    "洛阳市": { lat: 34.6197, lng: 112.4540, level: "市" },
    "平顶山市": { lat: 33.7453, lng: 113.1928, level: "市" },
    "安阳市": { lat: 36.1036, lng: 114.3927, level: "市" },
    "鹤壁市": { lat: 35.7554, lng: 114.2976, level: "市" },
    "新乡市": { lat: 35.3026, lng: 113.9268, level: "市" },
    "焦作市": { lat: 35.2161, lng: 113.2418, level: "市" },
    "濮阳市": { lat: 35.7617, lng: 115.0291, level: "市" },
    "许昌市": { lat: 34.0356, lng: 113.8519, level: "市" },
    "漯河市": { lat: 33.5815, lng: 114.0264, level: "市" },
    "三门峡市": { lat: 34.7773, lng: 111.2008, level: "市" },
    "南阳市": { lat: 32.9909, lng: 112.5288, level: "市" },
    "商丘市": { lat: 34.4138, lng: 115.6565, level: "市" },
    "信阳市": { lat: 32.1479, lng: 114.0756, level: "市" },
    "周口市": { lat: 33.6204, lng: 114.6965, level: "市" },
    "驻马店市": { lat: 32.9804, lng: 114.0492, level: "市" },
    "济源市": { lat: 35.0669, lng: 112.6020, level: "市" }
  },

  "湖北省": {
    "武汉市": { lat: 30.5928, lng: 114.3055, level: "市", aliases: ["武汉", "江城"] },
    "黄石市": { lat: 30.2202, lng: 115.0774, level: "市" },
    "十堰市": { lat: 32.6293, lng: 110.7982, level: "市" },
    "宜昌市": { lat: 30.7026, lng: 111.2908, level: "市" },
    "襄阳市": { lat: 32.0090, lng: 112.1441, level: "市" },
    "鄂州市": { lat: 30.3966, lng: 114.8909, level: "市" },
    "荆门市": { lat: 31.0356, lng: 112.2040, level: "市" },
    "孝感市": { lat: 30.9269, lng: 113.9269, level: "市" },
    "荆州市": { lat: 30.3270, lng: 112.2384, level: "市" },
    "黄冈市": { lat: 30.4477, lng: 114.8722, level: "市" },
    "咸宁市": { lat: 29.8426, lng: 114.3224, level: "市" },
    "随州市": { lat: 31.6902, lng: 113.3741, level: "市" },
    "恩施土家族苗族自治州": { lat: 30.2720, lng: 109.4889, level: "州" },
    "仙桃市": { lat: 30.3648, lng: 113.4539, level: "市" },
    "潜江市": { lat: 30.4210, lng: 112.8969, level: "市" },
    "天门市": { lat: 30.6531, lng: 113.1660, level: "市" },
    "神农架林区": { lat: 31.7442, lng: 110.6718, level: "林区" }
  },

  "湖南省": {
    "长沙市": { lat: 28.2282, lng: 112.9388, level: "市", aliases: ["长沙", "星城"] },
    "株洲市": { lat: 27.8274, lng: 113.1513, level: "市" },
    "湘潭市": { lat: 27.8294, lng: 112.9445, level: "市" },
    "衡阳市": { lat: 26.8934, lng: 112.6070, level: "市" },
    "邵阳市": { lat: 27.2375, lng: 111.4691, level: "市" },
    "岳阳市": { lat: 29.3702, lng: 113.1329, level: "市" },
    "常德市": { lat: 29.0319, lng: 111.6990, level: "市" },
    "张家界市": { lat: 29.1269, lng: 110.4793, level: "市" },
    "益阳市": { lat: 28.5701, lng: 112.3552, level: "市" },
    "郴州市": { lat: 25.7706, lng: 113.0328, level: "市" },
    "永州市": { lat: 26.4207, lng: 111.6088, level: "市" },
    "怀化市": { lat: 27.5501, lng: 109.9778, level: "市" },
    "娄底市": { lat: 27.7281, lng: 111.9939, level: "市" },
    "湘西土家族苗族自治州": { lat: 28.3115, lng: 109.7396, level: "州" }
  },

  "安徽省": {
    "合肥市": { lat: 31.8206, lng: 117.2272, level: "市", aliases: ["合肥", "庐州"] },
    "芜湖市": { lat: 31.3262, lng: 118.3721, level: "市" },
    "蚌埠市": { lat: 32.9164, lng: 117.3897, level: "市" },
    "淮南市": { lat: 32.6466, lng: 116.9929, level: "市" },
    "马鞍山市": { lat: 31.6890, lng: 118.5070, level: "市" },
    "淮北市": { lat: 33.9717, lng: 116.7989, level: "市" },
    "铜陵市": { lat: 30.9297, lng: 117.8167, level: "市" },
    "安庆市": { lat: 30.5255, lng: 117.0530, level: "市" },
    "黄山市": { lat: 29.7144, lng: 118.3378, level: "市" },
    "滁州市": { lat: 32.3173, lng: 118.3162, level: "市" },
    "阜阳市": { lat: 32.8963, lng: 115.8140, level: "市" },
    "宿州市": { lat: 33.6341, lng: 116.9640, level: "市" },
    "六安市": { lat: 31.7347, lng: 116.5073, level: "市" },
    "亳州市": { lat: 33.8440, lng: 115.7825, level: "市" },
    "池州市": { lat: 30.6600, lng: 117.4890, level: "市" },
    "宣城市": { lat: 30.9457, lng: 118.7578, level: "市" }
  },

  "江西省": {
    "南昌市": { lat: 28.6820, lng: 115.8581, level: "市", aliases: ["南昌", "洪城"] },
    "景德镇市": { lat: 29.2686, lng: 117.2142, level: "市" },
    "萍乡市": { lat: 27.6229, lng: 113.8520, level: "市" },
    "九江市": { lat: 29.7053, lng: 115.9850, level: "市" },
    "新余市": { lat: 27.8177, lng: 114.9302, level: "市" },
    "鹰潭市": { lat: 28.2384, lng: 117.0695, level: "市" },
    "赣州市": { lat: 25.8314, lng: 114.9409, level: "市" },
    "吉安市": { lat: 27.1138, lng: 114.9864, level: "市" },
    "宜春市": { lat: 27.8043, lng: 114.3916, level: "市" },
    "抚州市": { lat: 27.9839, lng: 116.3582, level: "市" },
    "上饶市": { lat: 28.4544, lng: 117.9713, level: "市" }
  },

  "福建省": {
    "福州市": { lat: 26.0745, lng: 119.2965, level: "市", aliases: ["福州", "榕城"] },
    "厦门市": { lat: 24.4798, lng: 118.0819, level: "市", aliases: ["厦门", "鹭岛"] },
    "莆田市": { lat: 25.4540, lng: 119.0077, level: "市" },
    "三明市": { lat: 26.2654, lng: 117.6389, level: "市" },
    "泉州市": { lat: 24.8748, lng: 118.6757, level: "市" },
    "漳州市": { lat: 24.5109, lng: 117.6470, level: "市" },
    "南平市": { lat: 26.6450, lng: 118.1778, level: "市" },
    "龙岩市": { lat: 25.0913, lng: 117.0175, level: "市" },
    "宁德市": { lat: 26.6651, lng: 119.5274, level: "市" }
  },

  "四川省": {
    "成都市": { lat: 30.6598, lng: 104.0633, level: "市", aliases: ["成都", "蓉城"] },
    "自贡市": { lat: 29.3528, lng: 104.7786, level: "市" },
    "攀枝花市": { lat: 26.5845, lng: 101.7185, level: "市" },
    "泸州市": { lat: 28.8719, lng: 105.4433, level: "市" },
    "德阳市": { lat: 31.1270, lng: 104.3979, level: "市" },
    "绵阳市": { lat: 31.4677, lng: 104.6794, level: "市" },
    "广元市": { lat: 32.4337, lng: 105.8446, level: "市" },
    "遂宁市": { lat: 30.5134, lng: 105.5713, level: "市" },
    "内江市": { lat: 29.5813, lng: 105.0584, level: "市" },
    "乐山市": { lat: 29.5821, lng: 103.7610, level: "市" },
    "南充市": { lat: 30.7954, lng: 106.0847, level: "市" },
    "眉山市": { lat: 30.0756, lng: 103.8312, level: "市" },
    "宜宾市": { lat: 28.7603, lng: 104.6308, level: "市" },
    "广安市": { lat: 30.4564, lng: 106.6333, level: "市" },
    "达州市": { lat: 31.2090, lng: 107.5023, level: "市" },
    "雅安市": { lat: 29.9877, lng: 103.0133, level: "市" },
    "巴中市": { lat: 31.8691, lng: 106.7533, level: "市" },
    "资阳市": { lat: 30.1284, lng: 104.6417, level: "市" },
    "阿坝藏族羌族自治州": { lat: 31.8997, lng: 102.2214, level: "州" },
    "甘孜藏族自治州": { lat: 30.0504, lng: 101.9638, level: "州" },
    "凉山彝族自治州": { lat: 27.8866, lng: 102.2587, level: "州" }
  },

  "贵州省": {
    "贵阳市": { lat: 26.6470, lng: 106.6302, level: "市", aliases: ["贵阳", "筑城"] },
    "六盘水市": { lat: 26.5918, lng: 104.8306, level: "市" },
    "遵义市": { lat: 27.7060, lng: 106.9069, level: "市" },
    "安顺市": { lat: 26.2532, lng: 105.9477, level: "市" },
    "毕节市": { lat: 27.2849, lng: 105.2913, level: "市" },
    "铜仁市": { lat: 27.7183, lng: 109.1973, level: "市" },
    "黔西南布依族苗族自治州": { lat: 25.0877, lng: 104.9062, level: "州" },
    "黔东南苗族侗族自治州": { lat: 26.5834, lng: 107.9851, level: "州" },
    "黔南布依族苗族自治州": { lat: 26.2578, lng: 107.5172, level: "州" }
  },

  "云南省": {
    "昆明市": { lat: 25.0389, lng: 102.7183, level: "市", aliases: ["昆明", "春城"] },
    "曲靖市": { lat: 25.5016, lng: 103.7976, level: "市" },
    "玉溪市": { lat: 24.3505, lng: 102.5437, level: "市" },
    "保山市": { lat: 25.1118, lng: 99.1670, level: "市" },
    "昭通市": { lat: 27.3380, lng: 103.7179, level: "市" },
    "丽江市": { lat: 26.8721, lng: 100.2277, level: "市" },
    "普洱市": { lat: 22.7773, lng: 100.9720, level: "市" },
    "临沧市": { lat: 23.8878, lng: 100.0769, level: "市" },
    "楚雄彝族自治州": { lat: 25.0415, lng: 101.5463, level: "州" },
    "红河哈尼族彝族自治州": { lat: 23.3677, lng: 103.3843, level: "州" },
    "文山壮族苗族自治州": { lat: 23.4009, lng: 104.2446, level: "州" },
    "西双版纳傣族自治州": { lat: 22.0017, lng: 100.7971, level: "州" },
    "大理白族自治州": { lat: 25.6066, lng: 100.2695, level: "州" },
    "德宏傣族景颇族自治州": { lat: 24.4367, lng: 98.5784, level: "州" },
    "怒江傈僳族自治州": { lat: 25.8506, lng: 98.8667, level: "州" },
    "迪庆藏族自治州": { lat: 27.8269, lng: 99.7065, level: "州" }
  },

  "陕西省": {
    "西安市": { lat: 34.3416, lng: 108.9398, level: "市", aliases: ["西安", "长安"] },
    "铜川市": { lat: 34.8969, lng: 108.9451, level: "市" },
    "宝鸡市": { lat: 34.3640, lng: 107.2372, level: "市" },
    "咸阳市": { lat: 34.3292, lng: 108.7047, level: "市" },
    "渭南市": { lat: 34.4996, lng: 109.5097, level: "市" },
    "延安市": { lat: 36.5853, lng: 109.4897, level: "市" },
    "汉中市": { lat: 33.0777, lng: 107.0283, level: "市" },
    "榆林市": { lat: 38.2902, lng: 109.7341, level: "市" },
    "安康市": { lat: 32.6840, lng: 109.0295, level: "市" },
    "商洛市": { lat: 33.8687, lng: 109.9408, level: "市" }
  },

  "甘肃省": {
    "兰州市": { lat: 36.0611, lng: 103.8343, level: "市", aliases: ["兰州", "金城"] },
    "嘉峪关市": { lat: 39.7865, lng: 98.2898, level: "市" },
    "金昌市": { lat: 38.5142, lng: 102.1880, level: "市" },
    "白银市": { lat: 36.5449, lng: 104.1738, level: "市" },
    "天水市": { lat: 34.5784, lng: 105.7249, level: "市" },
    "武威市": { lat: 37.9284, lng: 102.6381, level: "市" },
    "张掖市": { lat: 38.9255, lng: 100.4487, level: "市" },
    "平凉市": { lat: 35.5428, lng: 106.6656, level: "市" },
    "酒泉市": { lat: 39.7320, lng: 98.4938, level: "市" },
    "庆阳市": { lat: 35.7095, lng: 107.6437, level: "市" },
    "定西市": { lat: 35.5796, lng: 104.6262, level: "市" },
    "陇南市": { lat: 33.3886, lng: 104.9219, level: "市" },
    "临夏回族自治州": { lat: 35.5995, lng: 103.2127, level: "州" },
    "甘南藏族自治州": { lat: 34.9864, lng: 102.9109, level: "州" }
  },

  "青海省": {
    "西宁市": { lat: 36.6171, lng: 101.7782, level: "市", aliases: ["西宁"] },
    "海东市": { lat: 36.5023, lng: 102.1038, level: "市" },
    "海北藏族自治州": { lat: 36.9596, lng: 100.9013, level: "州" },
    "黄南藏族自治州": { lat: 35.5196, lng: 102.0198, level: "州" },
    "海南藏族自治州": { lat: 36.2804, lng: 100.6196, level: "州" },
    "果洛藏族自治州": { lat: 34.4717, lng: 100.2423, level: "州" },
    "玉树藏族自治州": { lat: 33.0062, lng: 97.0086, level: "州" },
    "海西蒙古族藏族自治州": { lat: 37.3737, lng: 97.3708, level: "州" }
  },

  "海南省": {
    "海口市": { lat: 20.0444, lng: 110.1989, level: "市", aliases: ["海口", "椰城"] },
    "三亚市": { lat: 18.2528, lng: 109.5122, level: "市" },
    "三沙市": { lat: 16.8310, lng: 112.3391, level: "市" },
    "儋州市": { lat: 19.5175, lng: 109.5766, level: "市" },
    "五指山市": { lat: 18.7769, lng: 109.5169, level: "市" },
    "琼海市": { lat: 19.2462, lng: 110.4665, level: "市" },
    "文昌市": { lat: 19.6129, lng: 110.7539, level: "市" },
    "万宁市": { lat: 18.7962, lng: 110.3887, level: "市" },
    "东方市": { lat: 19.1022, lng: 108.6537, level: "市" },
    "定安县": { lat: 19.6851, lng: 110.3490, level: "县" },
    "屯昌县": { lat: 19.3629, lng: 110.1020, level: "县" },
    "澄迈县": { lat: 19.7372, lng: 110.0071, level: "县" },
    "临高县": { lat: 19.9084, lng: 109.6875, level: "县" },
    "白沙黎族自治县": { lat: 19.2245, lng: 109.4524, level: "县" },
    "昌江黎族自治县": { lat: 19.2605, lng: 109.0530, level: "县" },
    "乐东黎族自治县": { lat: 18.7470, lng: 109.1752, level: "县" },
    "陵水黎族自治县": { lat: 18.5050, lng: 110.0371, level: "县" },
    "保亭黎族苗族自治县": { lat: 18.6364, lng: 109.7022, level: "县" },
    "琼中黎族苗族自治县": { lat: 19.0354, lng: 109.8397, level: "县" }
  },

  // 新疆、西藏、内蒙古、广西、宁夏自治区
  "新疆维吾尔自治区": {
    "乌鲁木齐市": { lat: 43.8256, lng: 87.6168, level: "市", aliases: ["乌鲁木齐", "乌市"] },
    "克拉玛依市": { lat: 45.5950, lng: 84.8891, level: "市" },
    "吐鲁番市": { lat: 42.9513, lng: 89.1889, level: "市" },
    "哈密市": { lat: 42.8335, lng: 93.5281, level: "市" },
    "昌吉回族自治州": { lat: 44.0070, lng: 87.3049, level: "州" },
    "博尔塔拉蒙古自治州": { lat: 44.9030, lng: 82.0519, level: "州" },
    "巴音郭楞蒙古自治州": { lat: 41.7681, lng: 86.1450, level: "州" },
    "阿克苏地区": { lat: 41.1707, lng: 80.2651, level: "地区" },
    "克孜勒苏柯尔克孜自治州": { lat: 39.7142, lng: 76.1679, level: "州" },
    "喀什地区": { lat: 39.4704, lng: 75.9899, level: "地区" },
    "和田地区": { lat: 37.1107, lng: 79.9253, level: "地区" },
    "伊犁哈萨克自治州": { lat: 43.9230, lng: 81.3281, level: "州" },
    "塔城地区": { lat: 46.7463, lng: 82.9857, level: "地区" },
    "阿勒泰地区": { lat: 47.8439, lng: 88.1396, level: "地区" },
    "石河子市": { lat: 44.3059, lng: 86.0411, level: "市" },
    "阿拉尔市": { lat: 40.5420, lng: 81.2769, level: "市" },
    "图木舒克市": { lat: 39.8673, lng: 79.0745, level: "市" },
    "五家渠市": { lat: 44.1674, lng: 87.5268, level: "市" },
    "北屯市": { lat: 47.3531, lng: 87.8249, level: "市" },
    "铁门关市": { lat: 41.8274, lng: 85.6725, level: "市" },
    "双河市": { lat: 44.8403, lng: 82.3537, level: "市" },
    "可克达拉市": { lat: 43.6832, lng: 80.9930, level: "市" },
    "昆玉市": { lat: 37.2072, lng: 79.2737, level: "市" },
    "胡杨河市": { lat: 44.6977, lng: 84.8275, level: "市" }
  },

  "西藏自治区": {
    "拉萨市": { lat: 29.6625, lng: 91.1146, level: "市", aliases: ["拉萨", "日光城"] },
    "日喀则市": { lat: 29.2630, lng: 88.8851, level: "市" },
    "昌都市": { lat: 31.1405, lng: 97.1785, level: "市" },
    "林芝市": { lat: 29.6544, lng: 94.3624, level: "市" },
    "山南市": { lat: 29.2360, lng: 91.7730, level: "市" },
    "那曲市": { lat: 31.4806, lng: 92.0670, level: "市" },
    "阿里地区": { lat: 32.5032, lng: 80.1055, level: "地区" }
  },

  "内蒙古自治区": {
    "呼和浩特市": { lat: 40.8414, lng: 111.7519, level: "市", aliases: ["呼和浩特", "呼市", "青城"] },
    "包头市": { lat: 40.6562, lng: 109.8403, level: "市" },
    "乌海市": { lat: 39.6739, lng: 106.8254, level: "市" },
    "赤峰市": { lat: 42.2574, lng: 118.8870, level: "市" },
    "通辽市": { lat: 43.6174, lng: 122.2632, level: "市" },
    "鄂尔多斯市": { lat: 39.6086, lng: 109.9899, level: "市" },
    "呼伦贝尔市": { lat: 49.2016, lng: 119.7651, level: "市" },
    "巴彦淖尔市": { lat: 40.7574, lng: 107.4160, level: "市" },
    "乌兰察布市": { lat: 41.0341, lng: 113.1325, level: "市" },
    "兴安盟": { lat: 46.0763, lng: 122.0704, level: "盟" },
    "锡林郭勒盟": { lat: 43.9447, lng: 116.0909, level: "盟" },
    "阿拉善盟": { lat: 38.8518, lng: 105.7286, level: "盟" }
  },

  "广西壮族自治区": {
    "南宁市": { lat: 22.8170, lng: 108.3669, level: "市", aliases: ["南宁", "邕", "绿城"] },
    "柳州市": { lat: 24.3146, lng: 109.4281, level: "市" },
    "桂林市": { lat: 25.2342, lng: 110.1792, level: "市" },
    "梧州市": { lat: 23.4740, lng: 111.2790, level: "市" },
    "北海市": { lat: 21.4813, lng: 109.1238, level: "市" },
    "防城港市": { lat: 21.7014, lng: 108.3545, level: "市" },
    "钦州市": { lat: 21.9804, lng: 108.6544, level: "市" },
    "贵港市": { lat: 23.0936, lng: 109.6027, level: "市" },
    "玉林市": { lat: 22.6314, lng: 110.1811, level: "市" },
    "百色市": { lat: 23.9024, lng: 106.6182, level: "市" },
    "贺州市": { lat: 24.4139, lng: 111.5521, level: "市" },
    "河池市": { lat: 24.6963, lng: 108.0852, level: "市" },
    "来宾市": { lat: 23.7338, lng: 109.2287, level: "市" },
    "崇左市": { lat: 22.4041, lng: 107.3644, level: "市" }
  },

  "宁夏回族自治区": {
    "银川市": { lat: 38.5026, lng: 106.2309, level: "市", aliases: ["银川", "凤凰城"] },
    "石嘴山市": { lat: 39.0133, lng: 106.3768, level: "市" },
    "吴忠市": { lat: 37.9974, lng: 106.1992, level: "市" },
    "固原市": { lat: 36.0046, lng: 106.2854, level: "市" },
    "中卫市": { lat: 37.4149, lng: 105.1896, level: "市" }
  },

  // === 港澳台地区完整数据 ===
  "香港特别行政区": {
    // 香港岛4区
    "中西区": { lat: 22.2855, lng: 114.1577, level: "区", aliases: ["中西区", "Central and Western"] },
    "湾仔区": { lat: 22.2783, lng: 114.1747, level: "区", aliases: ["湾仔", "Wan Chai"] },
    "东区": { lat: 22.2899, lng: 114.2094, level: "区", aliases: ["东区", "Eastern"] },
    "南区": { lat: 22.2460, lng: 114.1625, level: "区", aliases: ["南区", "Southern"] },
    
    // 九龙5区
    "油尖旺区": { lat: 22.3080, lng: 114.1714, level: "区", aliases: ["油尖旺", "Yau Tsim Mong"] },
    "深水埗区": { lat: 22.3298, lng: 114.1627, level: "区", aliases: ["深水埗", "Sham Shui Po"] },
    "九龙城区": { lat: 22.3219, lng: 114.1906, level: "区", aliases: ["九龙城", "Kowloon City"] },
    "黄大仙区": { lat: 22.3411, lng: 114.1987, level: "区", aliases: ["黄大仙", "Wong Tai Sin"] },
    "观塘区": { lat: 22.3112, lng: 114.2264, level: "区", aliases: ["观塘", "Kwun Tong"] },
    
    // 新界9区
    "北区": { lat: 22.4964, lng: 114.1486, level: "区", aliases: ["北区", "North"] },
    "大埔区": { lat: 22.4511, lng: 114.1634, level: "区", aliases: ["大埔", "Tai Po"] },
    "沙田区": { lat: 22.3821, lng: 114.1988, level: "区", aliases: ["沙田", "Sha Tin"] },
    "西贡区": { lat: 22.3818, lng: 114.2681, level: "区", aliases: ["西贡", "Sai Kung"] },
    "荃湾区": { lat: 22.3669, lng: 114.1176, level: "区", aliases: ["荃湾", "Tsuen Wan"] },
    "屯门区": { lat: 22.3910, lng: 113.9773, level: "区", aliases: ["屯门", "Tuen Mun"] },
    "元朗区": { lat: 22.4435, lng: 114.0374, level: "区", aliases: ["元朗", "Yuen Long"] },
    "葵青区": { lat: 22.3586, lng: 114.1289, level: "区", aliases: ["葵青", "Kwai Tsing"] },
    "离岛区": { lat: 22.2588, lng: 113.9444, level: "区", aliases: ["离岛", "Islands"] },
    
    // 香港整体
    "香港": { lat: 22.3193, lng: 114.1694, level: "特区", aliases: ["香港", "Hong Kong", "HK"] }
  },

  "澳门特别行政区": {
    // 澳门半岛5个堂区
    "花地玛堂区": { lat: 22.2087, lng: 113.5439, level: "堂区", aliases: ["北区", "Nossa Senhora de Fátima"] },
    "圣安多尼堂区": { lat: 22.1987, lng: 113.5439, level: "堂区", aliases: ["花王堂区", "Santo António"] },
    "大堂区": { lat: 22.1907, lng: 113.5439, level: "堂区", aliases: ["大堂", "Sé Catedral"] },
    "望德堂区": { lat: 22.1967, lng: 113.5508, level: "堂区", aliases: ["望德", "São Lázaro"] },
    "风顺堂区": { lat: 22.1847, lng: 113.5378, level: "堂区", aliases: ["风顺", "São Lourenço"] },
    
    // 离岛2个堂区
    "嘉模堂区": { lat: 22.1564, lng: 113.5594, level: "堂区", aliases: ["氹仔", "Nossa Senhora do Carmo"] },
    "圣方济各堂区": { lat: 22.1264, lng: 113.5594, level: "堂区", aliases: ["路环", "São Francisco Xavier"] },
    
    // 澳门整体
    "澳门": { lat: 22.1987, lng: 113.5439, level: "特区", aliases: ["澳门", "Macau", "Macao"] }
  },

  "台湾省": {
    // 6个直辖市
    "台北市": { lat: 25.0330, lng: 121.5654, level: "市", aliases: ["台北", "Taipei"] },
    "新北市": { lat: 25.0173, lng: 121.4627, level: "市", aliases: ["新北", "New Taipei"] },
    "桃园市": { lat: 24.9936, lng: 121.3010, level: "市", aliases: ["桃园", "Taoyuan"] },
    "台中市": { lat: 24.1477, lng: 120.6736, level: "市", aliases: ["台中", "Taichung"] },
    "台南市": { lat: 22.9999, lng: 120.2269, level: "市", aliases: ["台南", "Tainan"] },
    "高雄市": { lat: 22.6273, lng: 120.3014, level: "市", aliases: ["高雄", "Kaohsiung"] },
    
    // 3个市
    "基隆市": { lat: 25.1276, lng: 121.7391, level: "市", aliases: ["基隆", "Keelung"] },
    "新竹市": { lat: 24.8066, lng: 120.9686, level: "市", aliases: ["新竹", "Hsinchu"] },
    "嘉义市": { lat: 23.4801, lng: 120.4491, level: "市", aliases: ["嘉义", "Chiayi"] },
    
    // 13个县
    "新竹县": { lat: 24.8387, lng: 121.0177, level: "县", aliases: ["新竹县", "Hsinchu County"] },
    "苗栗县": { lat: 24.5601, lng: 120.8214, level: "县", aliases: ["苗栗", "Miaoli"] },
    "彰化县": { lat: 24.0518, lng: 120.5161, level: "县", aliases: ["彰化", "Changhua"] },
    "南投县": { lat: 23.9609, lng: 120.9718, level: "县", aliases: ["南投", "Nantou"] },
    "云林县": { lat: 23.7092, lng: 120.4313, level: "县", aliases: ["云林", "Yunlin"] },
    "嘉义县": { lat: 23.4520, lng: 120.2551, level: "县", aliases: ["嘉义县", "Chiayi County"] },
    "屏东县": { lat: 22.5519, lng: 120.5487, level: "县", aliases: ["屏东", "Pingtung"] },
    "宜兰县": { lat: 24.7021, lng: 121.7378, level: "县", aliases: ["宜兰", "Yilan"] },
    "花莲县": { lat: 23.9871, lng: 121.6015, level: "县", aliases: ["花莲", "Hualien"] },
    "台东县": { lat: 22.7972, lng: 121.1444, level: "县", aliases: ["台东", "Taitung"] },
    "澎湖县": { lat: 23.5711, lng: 119.5794, level: "县", aliases: ["澎湖", "Penghu"] },
    "金门县": { lat: 24.4365, lng: 118.3174, level: "县", aliases: ["金门", "Kinmen"] },
    "连江县": { lat: 26.1565, lng: 119.9397, level: "县", aliases: ["马祖", "Matsu", "连江"] },
    
    // 台湾整体
    "台湾": { lat: 23.8, lng: 121.0, level: "省", aliases: ["台湾", "Taiwan", "Formosa"] }
  }
};

/**
 * 海外华人聚居地数据库
 */
const OVERSEAS_CHINESE_REGIONS = {
  // === 东南亚华人聚居地 ===
  "新加坡": {
    "新加坡": { lat: 1.3521, lng: 103.8198, level: "国家", aliases: ["新加坡", "Singapore", "狮城", "星洲"] }
  },

  "马来西亚": {
    "吉隆坡": { lat: 3.1390, lng: 101.6869, level: "市", aliases: ["吉隆坡", "Kuala Lumpur", "KL"] },
    "新山": { lat: 1.4927, lng: 103.7414, level: "市", aliases: ["新山", "Johor Bahru"] },
    "槟城": { lat: 5.4164, lng: 100.3327, level: "市", aliases: ["槟城", "Penang", "乔治市", "George Town"] },
    "马六甲": { lat: 2.1896, lng: 102.2501, level: "市", aliases: ["马六甲", "Malacca", "Melaka"] },
    "怡保": { lat: 4.5975, lng: 101.0901, level: "市", aliases: ["怡保", "Ipoh"] },
    "古晋": { lat: 1.5533, lng: 110.3592, level: "市", aliases: ["古晋", "Kuching"] },
    "亚庇": { lat: 5.9804, lng: 116.0735, level: "市", aliases: ["亚庇", "Kota Kinabalu"] }
  },

  "泰国": {
    "曼谷": { lat: 13.7563, lng: 100.5018, level: "市", aliases: ["曼谷", "Bangkok"] },
    "清迈": { lat: 18.7883, lng: 98.9853, level: "市", aliases: ["清迈", "Chiang Mai"] },
    "普吉": { lat: 7.8804, lng: 98.3923, level: "市", aliases: ["普吉", "Phuket"] }
  },

  "印度尼西亚": {
    "雅加达": { lat: -6.2088, lng: 106.8456, level: "市", aliases: ["雅加达", "Jakarta"] },
    "泗水": { lat: -7.2575, lng: 112.7521, level: "市", aliases: ["泗水", "Surabaya"] },
    "棉兰": { lat: 3.5952, lng: 98.6722, level: "市", aliases: ["棉兰", "Medan"] }
  },

  "菲律宾": {
    "马尼拉": { lat: 14.5995, lng: 120.9842, level: "市", aliases: ["马尼拉", "Manila"] },
    "宿务": { lat: 10.3157, lng: 123.8854, level: "市", aliases: ["宿务", "Cebu"] }
  },

  "缅甸": {
    "仰光": { lat: 16.8661, lng: 96.1951, level: "市", aliases: ["仰光", "Yangon"] }
  },

  "越南": {
    "胡志明市": { lat: 10.8231, lng: 106.6297, level: "市", aliases: ["胡志明市", "Ho Chi Minh City", "西贡"] },
    "河内": { lat: 21.0285, lng: 105.8542, level: "市", aliases: ["河内", "Hanoi"] }
  },

  // === 北美华人聚居地 ===
  "美国": {
    "旧金山": { lat: 37.7749, lng: -122.4194, level: "市", aliases: ["旧金山", "San Francisco", "三藩市"] },
    "洛杉矶": { lat: 34.0522, lng: -118.2437, level: "市", aliases: ["洛杉矶", "Los Angeles", "LA"] },
    "纽约": { lat: 40.7128, lng: -74.0060, level: "市", aliases: ["纽约", "New York", "NYC"] },
    "西雅图": { lat: 47.6062, lng: -122.3321, level: "市", aliases: ["西雅图", "Seattle"] },
    "波士顿": { lat: 42.3601, lng: -71.0589, level: "市", aliases: ["波士顿", "Boston"] },
    "芝加哥": { lat: 41.8781, lng: -87.6298, level: "市", aliases: ["芝加哥", "Chicago"] },
    "休斯顿": { lat: 29.7604, lng: -95.3698, level: "市", aliases: ["休斯顿", "Houston"] },
    "费城": { lat: 39.9526, lng: -75.1652, level: "市", aliases: ["费城", "Philadelphia"] },
    "拉斯维加斯": { lat: 36.1699, lng: -115.1398, level: "市", aliases: ["拉斯维加斯", "Las Vegas"] },
    "华盛顿": { lat: 38.9072, lng: -77.0369, level: "市", aliases: ["华盛顿", "Washington DC"] }
  },

  "加拿大": {
    "温哥华": { lat: 49.2827, lng: -123.1207, level: "市", aliases: ["温哥华", "Vancouver"] },
    "多伦多": { lat: 43.6532, lng: -79.3832, level: "市", aliases: ["多伦多", "Toronto"] },
    "蒙特利尔": { lat: 45.5017, lng: -73.5673, level: "市", aliases: ["蒙特利尔", "Montreal"] },
    "卡尔加里": { lat: 51.0447, lng: -114.0719, level: "市", aliases: ["卡尔加里", "Calgary"] },
    "渥太华": { lat: 45.4215, lng: -75.6972, level: "市", aliases: ["渥太华", "Ottawa"] },
    "埃德蒙顿": { lat: 53.5461, lng: -113.4938, level: "市", aliases: ["埃德蒙顿", "Edmonton"] }
  },

  // === 欧洲华人聚居地 ===
  "英国": {
    "伦敦": { lat: 51.5074, lng: -0.1278, level: "市", aliases: ["伦敦", "London"] },
    "曼彻斯特": { lat: 53.4808, lng: -2.2426, level: "市", aliases: ["曼彻斯特", "Manchester"] },
    "伯明翰": { lat: 52.4862, lng: -1.8904, level: "市", aliases: ["伯明翰", "Birmingham"] }
  },

  "法国": {
    "巴黎": { lat: 48.8566, lng: 2.3522, level: "市", aliases: ["巴黎", "Paris"] },
    "马赛": { lat: 43.2965, lng: 5.3698, level: "市", aliases: ["马赛", "Marseille"] },
    "里昂": { lat: 45.7640, lng: 4.8357, level: "市", aliases: ["里昂", "Lyon"] }
  },

  "德国": {
    "柏林": { lat: 52.5200, lng: 13.4050, level: "市", aliases: ["柏林", "Berlin"] },
    "汉堡": { lat: 53.5511, lng: 9.9937, level: "市", aliases: ["汉堡", "Hamburg"] },
    "慕尼黑": { lat: 48.1351, lng: 11.5820, level: "市", aliases: ["慕尼黑", "Munich"] },
    "法兰克福": { lat: 50.1109, lng: 8.6821, level: "市", aliases: ["法兰克福", "Frankfurt"] }
  },

  "荷兰": {
    "阿姆斯特丹": { lat: 52.3676, lng: 4.9041, level: "市", aliases: ["阿姆斯特丹", "Amsterdam"] },
    "海牙": { lat: 52.0705, lng: 4.3007, level: "市", aliases: ["海牙", "The Hague"] },
    "鹿特丹": { lat: 51.9244, lng: 4.4777, level: "市", aliases: ["鹿特丹", "Rotterdam"] }
  },

  "意大利": {
    "罗马": { lat: 41.9028, lng: 12.4964, level: "市", aliases: ["罗马", "Rome"] },
    "米兰": { lat: 45.4642, lng: 9.1900, level: "市", aliases: ["米兰", "Milan"] }
  },

  "西班牙": {
    "马德里": { lat: 40.4168, lng: -3.7038, level: "市", aliases: ["马德里", "Madrid"] },
    "巴塞罗那": { lat: 41.3851, lng: 2.1734, level: "市", aliases: ["巴塞罗那", "Barcelona"] }
  },

  // === 大洋洲华人聚居地 ===
  "澳大利亚": {
    "悉尼": { lat: -33.8688, lng: 151.2093, level: "市", aliases: ["悉尼", "Sydney"] },
    "墨尔本": { lat: -37.8136, lng: 144.9631, level: "市", aliases: ["墨尔本", "Melbourne"] },
    "布里斯班": { lat: -27.4698, lng: 153.0251, level: "市", aliases: ["布里斯班", "Brisbane"] },
    "珀斯": { lat: -31.9505, lng: 115.8605, level: "市", aliases: ["珀斯", "Perth"] },
    "阿德莱德": { lat: -34.9285, lng: 138.6007, level: "市", aliases: ["阿德莱德", "Adelaide"] },
    "堪培拉": { lat: -35.2809, lng: 149.1300, level: "市", aliases: ["堪培拉", "Canberra"] }
  },

  "新西兰": {
    "奥克兰": { lat: -36.8485, lng: 174.7633, level: "市", aliases: ["奥克兰", "Auckland"] },
    "惠灵顿": { lat: -41.2865, lng: 174.7762, level: "市", aliases: ["惠灵顿", "Wellington"] },
    "基督城": { lat: -43.5321, lng: 172.6362, level: "市", aliases: ["基督城", "Christchurch"] }
  },

  // === 其他地区华人聚居地 ===
  "日本": {
    "东京": { lat: 35.6762, lng: 139.6503, level: "市", aliases: ["东京", "Tokyo"] },
    "大阪": { lat: 34.6937, lng: 135.5023, level: "市", aliases: ["大阪", "Osaka"] },
    "横滨": { lat: 35.4437, lng: 139.6380, level: "市", aliases: ["横滨", "Yokohama"] }
  },

  "韩国": {
    "首尔": { lat: 37.5665, lng: 126.9780, level: "市", aliases: ["首尔", "Seoul", "汉城"] },
    "釜山": { lat: 35.1796, lng: 129.0756, level: "市", aliases: ["釜山", "Busan"] }
  },

  "南非": {
    "约翰内斯堡": { lat: -26.2041, lng: 28.0473, level: "市", aliases: ["约翰内斯堡", "Johannesburg"] },
    "开普敦": { lat: -33.9249, lng: 18.4241, level: "市", aliases: ["开普敦", "Cape Town"] }
  }
};

/**
 * 历史地名和别名映射表
 */
const HISTORICAL_NAMES = {
  // === 古代都城和历史地名 ===
  "燕京": "北京市",
  "大都": "北京市", 
  "北平": "北京市",
  "幽州": "北京市",
  "金陵": "南京市",
  "建康": "南京市",
  "应天府": "南京市",
  "白下": "南京市",
  "石头城": "南京市",
  "临安": "杭州市",
  "汴京": "开封市",
  "汴梁": "开封市",
  "长安": "西安市",
  "京师": "北京市",
  "奉天": "沈阳市",
  "盛京": "沈阳市",
  "和林": "呼和浩特市",
  "归绥": "呼和浩特市",
  "迪化": "乌鲁木齐市",
  "库伦": "乌兰巴托",
  
  // === 现代省份简称 ===
  "京": "北京市",
  "津": "天津市", 
  "沪": "上海市",
  "渝": "重庆市",
  "冀": "河北省",
  "晋": "山西省",
  "蒙": "内蒙古自治区",
  "辽": "辽宁省",
  "吉": "吉林省",
  "黑": "黑龙江省",
  "苏": "江苏省",
  "浙": "浙江省",
  "皖": "安徽省",
  "闽": "福建省",
  "赣": "江西省",
  "鲁": "山东省",
  "豫": "河南省",
  "鄂": "湖北省",
  "湘": "湖南省",
  "粤": "广东省",
  "桂": "广西壮族自治区",
  "琼": "海南省",
  "川": "四川省",
  "蜀": "四川省",
  "黔": "贵州省",
  "滇": "云南省",
  "藏": "西藏自治区",
  "陕": "陕西省",
  "秦": "陕西省",
  "甘": "甘肃省",
  "陇": "甘肃省",
  "青": "青海省",
  "宁": "宁夏回族自治区",
  "新": "新疆维吾尔自治区",
  "港": "香港特别行政区",
  "澳": "澳门特别行政区",
  "台": "台湾省",
  
  // === 城市简称和别名 ===
  "穗": "广州市",
  "深": "深圳市",
  "杭": "杭州市",
  "宁": "南京市",
  "锡": "无锡市",
  "常": "常州市",
  "济": "济南市",
  "青": "青岛市",
  "蓉": "成都市",
  "筑": "贵阳市",
  "昆": "昆明市",
  "邕": "南宁市",
  "榕": "福州市",
  "厦": "厦门市",
  "洪": "南昌市",
  "汉": "武汉市",
  "长": "长沙市",
  "郑": "郑州市",
  "石": "石家庄市",
  
  // === 城市雅称和别名 ===
  "羊城": "广州市",
  "花城": "广州市",
  "五羊城": "广州市",
  "鹏城": "深圳市", 
  "泉城": "济南市",
  "山城": "重庆市",
  "雾都": "重庆市",
  "火炉": "重庆市",
  "春城": "昆明市",
  "日光城": "拉萨市",
  "冰城": "哈尔滨市",
  "星城": "长沙市",
  "江城": "武汉市",
  "九省通衢": "武汉市",
  "东方巴黎": "哈尔滨市",
  "东方莫斯科": "哈尔滨市",
  "北国春城": "长春市",
  "塞上明珠": "呼和浩特市",
  "青城": "呼和浩特市",
  "草原钢城": "包头市",
  "丝绸之路明珠": "兰州市",
  "金城": "兰州市",
  "天府之国": "成都市",
  "锦城": "成都市",
  "芙蓉城": "成都市",
  "椰城": "海口市",
  "鹿城": "三亚市",
  "绿城": "南宁市",
  
  // === 港澳台别名 ===
  "东方之珠": "香港",
  "购物天堂": "香港",
  "亚洲四小龙": "香港",
  "赌城": "澳门",
  "东方蒙特卡洛": "澳门",
  "福尔摩沙": "台湾",
  "宝岛": "台湾",
  "美丽岛": "台湾",
  
  // === 海外华人聚居地别名 ===
  "狮城": "新加坡",
  "星洲": "新加坡",
  "花园城市": "新加坡",
  "三藩市": "旧金山",
  "金山": "旧金山",
  "天使之城": "洛杉矶",
  "大苹果": "纽约",
  "不夜城": "纽约",
  "风城": "芝加哥",
  "汽车城": "底特律",
  "音乐之城": "纳什维尔",
  "太空城": "休斯顿",
  "赌城": "拉斯维加斯",
  "罪恶之城": "拉斯维加斯",
  "枫叶之国": "加拿大",
  "雾都": "伦敦",
  "光明之城": "巴黎",
  "浪漫之都": "巴黎",
  "永恒之城": "罗马",
  "时尚之都": "米兰",
  "音乐之都": "维也纳",
  "啤酒之都": "慕尼黑",
  "袋鼠国": "澳大利亚",
  "悉尼歌剧院": "悉尼",
  "花园之州": "新西兰",
  "长白云之乡": "新西兰",
  "樱花之国": "日本",
  "富士山": "日本",
  "汉城": "首尔",
  "泡菜国": "韩国",
  "彩虹之国": "南非"
};

/**
 * 地理位置查询服务类
 */
export class GeoLookupService {
  constructor() {
    this.regions = CHINA_REGIONS;
    this.overseasRegions = OVERSEAS_CHINESE_REGIONS;
    this.allRegions = { ...CHINA_REGIONS, ...OVERSEAS_CHINESE_REGIONS };
    this.historicalNames = HISTORICAL_NAMES;
  }

  /**
   * 查询地理位置
   * @param {string} address - 地址字符串
   * @returns {Object} 查询结果
   */
  lookupAddress(address) {
    try {
      if (!address || typeof address !== 'string') {
        throw new Error('地址参数无效');
      }

      // 预处理地址
      const normalizedAddress = this.normalizeAddress(address);
      
      // 历史地名转换
      const modernAddress = this.convertHistoricalNames(normalizedAddress);

      // 尝试不同的匹配策略
      let result = this.exactMatch(modernAddress) ||
                   this.hierarchyMatch(modernAddress) ||
                   this.aliasMatch(modernAddress) ||
                   this.fuzzyMatch(modernAddress);

      if (result) {
        return {
          success: true,
          data: {
            inputAddress: address,
            standardName: result.standardName,
            latitude: result.lat,
            longitude: result.lng,
            level: result.level,
            province: result.province,
            city: result.city,
            district: result.district,
            confidence: result.confidence || 1.0
          }
        };
      }

      throw new Error(`未找到地址: ${address}`);
    } catch (error) {
      return {
        success: false,
        error: error.message,
        data: null
      };
    }
  }

  /**
   * 地址标准化
   * @param {string} address - 原始地址
   * @returns {string} 标准化后的地址
   */
  normalizeAddress(address) {
    return address
      .trim()
      .replace(/\s+/g, '')  // 删除空格
      .replace(/市$/, '市')  // 确保市字正确
      .replace(/省$/, '省')  // 确保省字正确
      .replace(/区$/, '区')  // 确保区字正确
      .replace(/县$/, '县'); // 确保县字正确
  }

  /**
   * 历史地名转换
   * @param {string} address - 地址
   * @returns {string} 转换后的地址
   */
  convertHistoricalNames(address) {
    // 按照长度降序排列，避免短的关键词误匹配长地名的一部分
    const sortedEntries = Object.entries(this.historicalNames)
      .sort(([a], [b]) => b.length - a.length);
    
    for (const [historical, modern] of sortedEntries) {
      // 使用完整词匹配，避免部分字符匹配
      if (address === historical) {
        return modern;
      }
    }
    return address;
  }

  /**
   * 精确匹配
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  exactMatch(address) {
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        const fullName = province === city ? city : `${province}${city}`;
        // 检查完整地名、城市名、以及别名
        if (address === fullName || address === city) {
          return {
            ...data,
            standardName: fullName,
            province: province,
            city: city,
            district: data.level === '区' ? city : null,
            confidence: 1.0
          };
        }
        
        // 检查别名
        if (data.aliases) {
          for (const alias of data.aliases) {
            if (address === alias) {
              return {
                ...data,
                standardName: fullName,
                province: province,
                city: city,
                district: data.level === '区' ? city : null,
                confidence: 1.0
              };
            }
          }
        }
      }
    }
    return null;
  }

  /**
   * 层级匹配 (省->市->区)
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  hierarchyMatch(address) {
    // 提取省市区信息
    const provinceMatch = address.match(/(.+?省)/);
    const cityMatch = address.match(/(.+?市)/);
    const districtMatch = address.match(/(.+?[区县])/);

    if (provinceMatch) {
      const province = provinceMatch[1];
      if (this.allRegions[province]) {
        // 如果有市信息
        if (cityMatch) {
          const city = cityMatch[1];
          if (this.allRegions[province][city]) {
            return {
              ...this.allRegions[province][city],
              standardName: `${province}${city}`,
              province: province,
              city: city,
              district: null,
              confidence: 0.9
            };
          }
        }
        // 返回省会城市
        const provincialCapital = Object.values(this.allRegions[province])[0];
        if (provincialCapital) {
          return {
            ...provincialCapital,
            standardName: province,
            province: province,
            city: Object.keys(this.allRegions[province])[0],
            district: null,
            confidence: 0.7
          };
        }
      }
    }

    return null;
  }

  /**
   * 别名匹配
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  aliasMatch(address) {
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        if (data.aliases) {
          for (const alias of data.aliases) {
            if (address.includes(alias)) {
              return {
                ...data,
                standardName: `${province}${city}`,
                province: province,
                city: city,
                district: data.level === '区' ? city : null,
                confidence: 0.8
              };
            }
          }
        }
      }
    }
    return null;
  }

  /**
   * 模糊匹配
   * @param {string} address - 地址
   * @returns {Object|null} 匹配结果
   */
  fuzzyMatch(address) {
    let bestMatch = null;
    let bestScore = 0;

    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        const fullName = province === city ? city : `${province}${city}`;
        const score = this.calculateSimilarity(address, fullName);
        
        if (score > bestScore && score > 0.6) {
          bestScore = score;
          bestMatch = {
            ...data,
            standardName: fullName,
            province: province,
            city: city,
            district: data.level === '区' ? city : null,
            confidence: score
          };
        }

        // 也检查城市名本身
        const cityScore = this.calculateSimilarity(address, city);
        if (cityScore > bestScore && cityScore > 0.6) {
          bestScore = cityScore;
          bestMatch = {
            ...data,
            standardName: fullName,
            province: province,
            city: city,
            district: data.level === '区' ? city : null,
            confidence: cityScore
          };
        }
      }
    }

    return bestMatch;
  }

  /**
   * 计算字符串相似度
   * @param {string} str1 - 字符串1
   * @param {string} str2 - 字符串2
   * @returns {number} 相似度 (0-1)
   */
  calculateSimilarity(str1, str2) {
    const longer = str1.length > str2.length ? str1 : str2;
    const shorter = str1.length > str2.length ? str2 : str1;
    
    if (longer.length === 0) return 1.0;
    
    const distance = this.levenshteinDistance(longer, shorter);
    return (longer.length - distance) / longer.length;
  }

  /**
   * 计算编辑距离 (Levenshtein Distance)
   * @param {string} str1 - 字符串1
   * @param {string} str2 - 字符串2
   * @returns {number} 编辑距离
   */
  levenshteinDistance(str1, str2) {
    const matrix = [];

    for (let i = 0; i <= str2.length; i++) {
      matrix[i] = [i];
    }

    for (let j = 0; j <= str1.length; j++) {
      matrix[0][j] = j;
    }

    for (let i = 1; i <= str2.length; i++) {
      for (let j = 1; j <= str1.length; j++) {
        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
          matrix[i][j] = matrix[i - 1][j - 1];
        } else {
          matrix[i][j] = Math.min(
            matrix[i - 1][j - 1] + 1, // substitution
            matrix[i][j - 1] + 1,     // insertion
            matrix[i - 1][j] + 1      // deletion
          );
        }
      }
    }

    return matrix[str2.length][str1.length];
  }

  /**
   * 获取支持的地区列表
   * @returns {Array} 地区列表
   */
  getSupportedRegions() {
    const regions = [];
    for (const [province, cities] of Object.entries(this.allRegions)) {
      for (const [city, data] of Object.entries(cities)) {
        regions.push({
          province,
          city,
          level: data.level,
          latitude: data.lat,
          longitude: data.lng,
          aliases: data.aliases || []
        });
      }
    }
    return regions;
  }
}

// 导出单例实例
export const geoLookupService = new GeoLookupService();